<ng-template #modal let-modal>
  <div class="modal-header">
    <h4 class="text-primary modal-title">
      Lista de <strong>APU</strong> registrados
    </h4>
    <button
      type="button"
      class="close"
      data-dismiss="modal"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <mat-form-field class="col" appearance="outline">
        <mat-label>Nombre</mat-label>
        <input
          matInput
          type="text"
          [(ngModel)]="filtros.name"
          placeholder="Busca por nombre"
          (input)="getApus()"
          name="name"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field class="col" appearance="outline">
        <mat-label>Cliente</mat-label>
        <input
          matInput
          type="text"
          [(ngModel)]="filtros.client"
          placeholder="Busca por cliente"
          (input)="getApus()"
          name="client"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field class="col" appearance="outline">
        <mat-label>Línea</mat-label>
        <input
          matInput
          type="text"
          [(ngModel)]="filtros.line"
          placeholder="Busca por línea"
          (input)="getApus()"
          name="line"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field class="col" appearance="outline">
        <mat-label>Tipo</mat-label>
        <mat-select
          name="type"
          [(ngModel)]="filtros.type"
          (selectionChange)="getApus()"
        >
          <mat-option value="">Todos</mat-option>
          <mat-option value="Pieza">Pieza</mat-option>
          <mat-option value="Conjunto">Conjunto</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <ng-container *ngIf="apus.length && !loading; else notData">
      <div class="rounded-top table-responsive">
        <table class="table table-bordered table-striped table-sm">
          <thead class="bg-light">
            <tr class="text-center text-uppercase">
              <th><i class="fas fa-check"></i></th>
              <th>Fecha de Creación</th>
              <th>Código</th>
              <th>Nombre</th>
              <th>Destino</th>
              <th>Cliente</th>
              <th>Linea</th>
              <th>Tipo</th>
              <th>Costo unitario</th>
              <th><i class="mdi mdi-chevron-down"></i></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let apu of apus" class="text-center">
              <td class="align-middle">
                <input
                  type="checkbox"
                  [checked]="apu.selected"
                  (change)="setState(apu)"
                />
              </td>
              <td class="align-middle">{{ apu.created_at | date }}</td>
              <td class="align-middle">{{ apu.code }}</td>
              <td class="align-middle">{{ apu.name }}</td>
              <td class="align-middle">{{ apu.city.name }}</td>
              <td class="align-middle">{{ apu.third_party.full_name }}</td>
              <td class="align-middle">{{ apu.line }}</td>
              <td class="align-middle">{{ apu.type_name }}</td>
              <td class="align-middle">
                {{ apu.unit_cost | currency : "COP" }}
              </td>
              <td class="align-middle">
                <div ngbDropdown container="body" class="dropdown-primary">
                  <button
                    ngbDropdownToggle
                    class="btn btn-primary btn-sm waves-light"
                    type="button"
                  >
                    <i class="mdi mdi-chevron-down"></i>
                  </button>
                  <div ngbDropdownMenu>
                    <a
                      role="button"
                      class="dropdown-item waves-light text-success caja-botones"
                      (click)="openNewTab(apu.type, apu.apu_id)"
                    >
                      <i class="far fa-eye"></i> Ver
                    </a>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-container>
    <ngb-pagination
      class="d-flex justify-content-center pagination-rounded pagination-sm"
      [collectionSize]="pagination.collectionSize"
      [pageSize]="pagination.pageSize"
      [(page)]="pagination.page"
      (pageChange)="getApus($event)"
      aria-label="Default pagination"
      maxSize="5"
      rotate="true"
      ellipses="false"
      boundaryLinks="true"
    >
    </ngb-pagination>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-danger"
      (click)="modal.dismiss('Cross click')"
    >
      Cancelar
    </button>
    <button type="button" (click)="send()" class="btn btn-primary">
      Agregar
    </button>
  </div>
</ng-template>

<ng-template #notData>
  <app-not-data
    [loading]="loading"
    [text]="'No hay resultados de APU'"
  ></app-not-data>
</ng-template>
