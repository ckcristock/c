<div class="card">
  <div class="card-body">
    <div class="card-title">
      <h4 class="text-primary">Localidades</h4>
    </div>
    <hr class="line" />
    <div class="row">
      <div [ngClass]="{ 'col-lg-3': countrySelected == 1 , 'col-lg-4 mb-3': countrySelected != 1}">
        <ul class="list-group list-group-flush">
          <li
            class="rounded-top list-group-item list-group-item-primary d-flex justify-content-between"
          >
            <b>Paises</b>
            <span>
              <button
                class="btn btn-primary btn-sm"
                (click)="openModal('paises', add)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </span>
          </li>

          <div *ngIf="!loadingCountry && countries != null; else notDataCountry" >
            <li
              role="button"
              *ngFor="let country of countries"
              [ngClass]="{ 'border border-primary': country.selected }"

              class="list-group-item d-flex justify-content-between align-items-center rounded"
              (click)="
                getStates(country.value); selected(countries, country.value);
              "
            >
              {{country.text}}
              <span ngbDropdown container="body" class="dropdown-primary">
                <button
                  ngbDropdownToggle
                  class="btn btn-primary btn-sm waves-light"
                  type="button"
                >
                  <i class="mdi mdi-chevron-down"></i>
                </button>
                <div ngbDropdownMenu>
                  <a
                    href="javascript: void(0);"
                    class="dropdown-item text-info waves-light caja-botones"
                    (click)="editar('paises', country, add)"
                  >
                    <i class="fas fa-edit color-info"></i> Editar</a
                  >
                </div>
              </span>
            </li>
          </div>
        </ul>
      </div>

      <div [ngClass]="{ 'col-lg-3': countrySelected == 1 , 'col-lg-4 mb-3': countrySelected != 1}">
        <ul class="list-group list-group-flush">
          <li
            class="rounded-top list-group-item list-group-item-primary d-flex justify-content-between"
          >
            <b>Departamentos</b>
            <span>
              <button
                class="btn btn-primary btn-sm"
                (click)="openModal('departamentos', add)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </span>
          </li>

          <div *ngIf="!loadingState && states != null; else notDataState">
            <li
              role="button"
              *ngFor="let state of states"
              [ngClass]="{ 'border border-primary': state.selected }"
              class="list-group-item d-flex justify-content-between align-items-center rounded"
              (click)=" (coutrySelected == 1) ? getCities(state.value) : getMunicipalities(state.value);
                       selected(states, state.value);
              "
            >
              {{state.text}}
              <span ngbDropdown container="body" class="dropdown-primary">
                <button
                  ngbDropdownToggle
                  class="btn btn-primary btn-sm waves-light"
                  type="button"
                >
                  <i class="mdi mdi-chevron-down"></i>
                </button>
                <div ngbDropdownMenu>
                  <a
                    href="javascript: void(0);"
                    class="dropdown-item text-info waves-light caja-botones"
                    (click)="editar('departamentos', state, add)"
                  >
                    <i class="fas fa-edit color-info"></i> Editar</a
                  >
                </div>
              </span>
            </li>
          </div>
        </ul>
      </div>

      <div class="col-lg-3 mb-3" *ngIf="countrySelected == 1">
        <ul class="list-group list-group-flush">
          <li
            class="rounded-top list-group-item list-group-item-primary d-flex justify-content-between"
          >
            <b>Municipios</b>
            <span>
              <button
                class="btn btn-primary btn-sm"
                (click)="openModal('municipios', add)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </span>
          </li>

          <div *ngIf="!loadingState && municipalities != null; else notDataMunicipality">
            <li
              role="button"
              *ngFor="let municipality of municipalities"
              [ngClass]="{ 'border border-primary': municipality.selected }"
              class="list-group-item d-flex justify-content-between align-items-center rounded"
              (click)="
                  getCitiesByMunicipality(municipality.value); selected(municipalities, municipality.value);
              "
            >
              {{municipality.text}}
              <span ngbDropdown container="body" class="dropdown-primary">
                <button
                  ngbDropdownToggle
                  class="btn btn-primary btn-sm waves-light"
                  type="button"
                >
                  <i class="mdi mdi-chevron-down"></i>
                </button>
                <div ngbDropdownMenu>
                  <a
                    href="javascript: void(0);"
                    class="dropdown-item text-info waves-light caja-botones"
                    (click)="editar('municipios', municipality, add)"
                  >
                    <i class="fas fa-edit color-info"></i> Editar</a
                  >
                </div>
              </span>
            </li>
          </div>
        </ul>
      </div>

      <div [ngClass]="{ 'col-lg-3': countrySelected == 1 , 'col-lg-4 mb-3': countrySelected != 1}">
        <ul class="list-group list-group-flush">
          <li
            class="rounded-top list-group-item list-group-item-primary d-flex justify-content-between"
          >
            <b>Ciudades</b>
            <span>
              <button
                class="btn btn-primary btn-sm"
                (click)="openModal('ciudades', add)"
              >
                <i class="fa fa-plus"></i>
              </button>
            </span>
          </li>

          <div *ngIf="!loadingCity && cities != null; else notDataCity">
            <li
              role="button"
              *ngFor="let city of cities"
              [ngClass]="{ 'border border-primary': city.selected }"
              class="list-group-item d-flex justify-content-between align-items-center rounded"
              (click)="
                selected(cities, city.value);
              "
            >
              {{city.text}}
              <span ngbDropdown container="body" class="dropdown-primary">
                <button
                  ngbDropdownToggle
                  class="btn btn-primary btn-sm waves-light"
                  type="button"
                >
                  <i class="mdi mdi-chevron-down"></i>
                </button>
                <div ngbDropdownMenu>
                  <a
                    href="javascript: void(0);"
                    class="dropdown-item text-info waves-light caja-botones"
                    (click)="editar('ciudades', city, add)"
                  >
                    <i class="fas fa-edit color-info"></i> Editar</a
                  >
                </div>
              </span>
            </li>
          </div>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- <swal
  #anulacion
  title="Eliminando item. Presiona sí para continuar"
  icon="warning"
  showCancelButton="true"
  confirmButtonText="Sí"
  cancelButtonText="No"
></swal>

<swal #deleteSwal title="Item eliminado con éxito" icon="success"> </swal>
 -->
<ng-template #add let-modal>
  <div class="modal-header">
    <h4 class="text-primary modal-title">Lista de {{ tipo }}</h4>
    <button
      type="button"
      class="close"
      data-dismiss="modal"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form changeForm="ngForm">

      <div class="row mt-3">
        <div *ngIf="tipo != 'paises'" class="col-md-12 px-0">
          <mat-form-field appearance="outline" class="col-md-12">
            <mat-label>Paises</mat-label>
            <mat-select
              (selectionChange)="getStates($event.value)"
              [(value)]="countrySelected"
            >
              <mat-option
                *ngFor="let item of countries"
                [value]="item.value"
                (click)="selected(countries, item.value)"
                >{{ item.text }}</mat-option
              >
            </mat-select>
          </mat-form-field>

          <div *ngIf="tipo == 'ciudades' && countrySelected != 1">
            <mat-form-field appearance="outline" class="col-md-12">
              <mat-label>Departamentos</mat-label>
              <mat-select
                (selectionChange)="getStates($event.value)"
                [(value)]="stateSelected">
                <mat-option
                  *ngFor="let item of states"
                  [(value)]="item.value"
                  (click)="selected(states, item.value)"
                  >{{ item.text }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div *ngIf="tipo == 'municipios'">
            <mat-form-field appearance="outline" class="col-md-12">
              <mat-label>Departamentos</mat-label>
              <mat-select
                (selectionChange)="getStates($event.value)"
                [(value)]="stateSelected">
                <mat-option
                  *ngFor="let item of states"
                  [(value)]="item.value"
                  (click)="selected(states, item.value); stateSelected = item.value"
                  >{{ item.text }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div *ngIf=" tipo == 'ciudades' && countrySelected == 1">
            <mat-form-field appearance="outline" class="col-md-12">
              <mat-label>Departamentos</mat-label>
              <mat-select
                (selectionChange)="getStates($event.value)"
                [(value)]="stateSelected">
                <mat-option
                  *ngFor="let item of states"
                  [(value)]="item.value"
                  (click)="selected(states, item.value); stateSelected = item.value"
                  >{{ item.text }}
                </mat-option>
              </mat-select>

            </mat-form-field>

            <mat-form-field  appearance="outline" class="col-md-12">
              <mat-label>Municipios</mat-label>
              <mat-select
              (selectionChange)="getMunicipalities($event.value)"
              [(value)]="municipalitySelected">
              <mat-option
              *ngFor="let item of municipalities"
              [(value)]="item.value"
              (click)="selected(municipalities, item.value)"
              >{{ item.text }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          </div>

        </div><!--fin de ngId paises, departamento-->
        <mat-form-field class="col-md-12" appearance="outline">
          <mat-label>Nombre</mat-label>
          <input
            matInput
            type="text"
            name="name"
            autocomplete="off"
            [(ngModel)]="name"
            placeholder="Ingrese el nombre"
          />
        </mat-form-field>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-danger"
      (click)="modal.dismiss('Cross click')"
    >
      Cancelar
    </button>
    <button
      *ngIf="tipo == 'paises'"
      [disabled]="name == ''"
      type="button"
      (click)="save()"
      class="btn btn-primary"
    >
      Guardar
    </button>
    <button
      *ngIf="tipo == 'departamentos'"
      [disabled]="name == '' || countries== null"
      type="button"
      (click)="save()"
      class="btn btn-primary"
    >
      Guardar
    </button>
    <button
      *ngIf="tipo == 'municipios'"
      [disabled]="name == '' || states==null || countries== null"
      type="button"
      (click)="save()"
      class="btn btn-primary"
    >
      Guardar
    </button>
    <button
      *ngIf="tipo == 'ciudades'"
      [disabled]="name == '' || states==null || countries==null"
      type="button"
      (click)="save()"
      class="btn btn-primary"
    >
      Guardar
    </button>
  </div>
</ng-template>

<ng-template #notDataCountry>
  <app-not-data [loading]="loadingCountry"></app-not-data>
</ng-template>

<ng-template #notDataState>
  <app-not-data [loading]="loadingState"></app-not-data>
</ng-template>

<ng-template #notDataMunicipality>
  <app-not-data [loading]="loadingMunicipality"></app-not-data>
</ng-template>

<ng-template #notDataCity>
  <app-not-data [loading]="loadingCity"></app-not-data>
</ng-template>

