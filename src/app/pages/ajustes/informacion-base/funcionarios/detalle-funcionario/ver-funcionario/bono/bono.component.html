<div class="card-title d-flex justify-content-between">
  <h5>Bonificación recurrente</h5>
  <button
    class="btn btn-link pt-0 edit"
    style="float: right"
    (click)="openConfirm(add)"
  >
    <i class="fas fa-plus"></i>
  </button>
</div>
<div class="">
  <table
    *ngIf="!loading && bonu.length > 0; else notData"
    class="table table-striped table-sm"
  >
    <thead>
      <tr>
        <th scope="col">Tipo de bono</th>
        <th scope="col">Valor</th>
        <th scope="col">Acción</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let bon of bonu"
        [ngClass]="{ 'text-danger font-weight-bold': bon.status == 0 }"
      >
        <th scope="row">{{ bon.concept }}</th>
        <td>{{ bon.value }}</td>
        <td>
          <button
            class="btn btn-danger btn-sm"
            *ngIf="bon.status == 1"
            (click)="anular(bon, 0)"
          >
            <i class="far fa-trash-alt"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<ng-template #add let-modal>
  <div class="modal-header">
    <h4 class="text-primary modal-title">Nueva Bonificación</h4>
    <button
      type="button"
      class="btn btn-sm btn-flash-border-primary ri-close-fill"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="form">
      <div class="form-row">
        <div class="form-group col-12">
          <label class="custom-label" for="type_of_bonus">Tipo de bono</label>
          <select
            (change)="getBonusList($event.target.value)"
            class="form-select form-control"
            id="type_of_bonus"
          >
            <option selected>Seleccionar para obtener lista de bono</option>
            <option
              *ngFor="let bonusType of bonusTypes"
              [value]="bonusType.valor"
            >
              {{ bonusType.clave }}
            </option>
          </select>
          <!-- <div class="col-md-7 offset-4">
                            <small class="invalid text-danger" *ngIf="bonus_type_valid"> Es necesario el tipo de bono
                            </small>
                        </div> -->
        </div>
        <div class="form-group col-12">
          <label class="custom-label" for="bonus">Bono</label>
          <ng-select
            class="col-md-12 p-0"
            [items]="bonus"
            formControlName="countable_income_id"
            placeholder="Seleccionar"
            bindLabel="text"
            bindValue="value"
            loadingText="loading"
            ngDefaultControl
          >
          </ng-select>
          <div class="col-md-7 offset-4">
            <small class="invalid text-danger" *ngIf="bonus_type_valid">
              Es necesario el bono
            </small>
          </div>
        </div>
        <div class="form-group col-12">
          <label class="custom-label" for="valor">Valor</label>
          <input
            type="number"
            [class.is-invalid]="value_valid"
            placeholder="0.00"
            formControlName="value"
            class="form-control"
            id="valor"
            required
          />
          <div class="col-md-7 offset-4">
            <small class="invalid text-danger" *ngIf="value_valid">
              Es necesario el valor
            </small>
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-default"
      (click)="modal.dismiss('Cross click')"
    >
      Cancelar
    </button>
    <button
      type="button"
      (click)="addBonus()"
      [disabled]="!form.valid"
      class="btn btn-primary"
    >
      Guardar
    </button>
  </div>
</ng-template>

<ng-template #notData>
  <app-not-data [loading]="loading"></app-not-data>
</ng-template>
