<div class="card-title d-flex justify-content-between">
  <h6><i class="fas fa-money-bill"></i> Salario</h6>
  <button class="btn btn-link" (click)="openModal()">
    <i class="fas fa-pencil-alt"></i>
  </button>
</div>

<div *ngIf="!loading && salary_info; else notData">
  <h5 class="text-center text-success">${{ salary_info.salary | number }}</h5>

  <div class="row">
    <div class="col-lg-6 text-lg-right text-center text-primary">
      Tipo de contrato
    </div>

    <div class="col-lg-6 text-lg-left text-center">
      {{ salary_info.contract_type }}
    </div>

    <div class="col-lg-6 text-lg-right text-center text-primary">
      Fecha de ingreso
    </div>

    <div class="col-lg-6 text-lg-left text-center">
      {{ salary_info.date_of_admission }}
    </div>
    <div
      class="col-lg-6 text-lg-right text-center text-primary"
      *ngIf="salary_info.work_contract_type_id == 2"
    >
      Fecha de retiro
    </div>
    <div
      class="col-lg-6 text-lg-left text-center"
      *ngIf="salary_info.work_contract_type_id == 2"
    >
      {{ salary_info.date_end }}
    </div>
  </div>
  <hr />
  <app-bono *ngIf="salary_info.id" [id]="salary_info.id"></app-bono>
  <h6>Historial de contratos</h6>
  <div class="rounded-top table-responsive">
    <table
      class="table table-bordered table-striped table-sm"
      *ngIf="salary_history.length > 0"
    >
      <thead class="bg-light">
        <tr class="text-center text-uppercase">
          <th>Salario</th>
          <th>Tipo</th>
          <th>Ingreso</th>
          <th>Finalización</th>
          <th>Cargo</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of salary_history" class="text-center">
          <th>{{ item.salary | number }}</th>
          <th>{{ item.work_contract_type.name }}</th>
          <th>{{ item.date_of_admission | date: "longDate" }}</th>
          <th>{{ item.date_end | date: "longDate" }}</th>
          <th>{{ item.position.name }}</th>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #notData>
  <app-not-data [loading]="loading"></app-not-data>
</ng-template>


<ng-template #add let-modal>
  <div class="modal-header">
    <h4 class="text-primary modal-title">Editar salario</h4>
    <button
      type="button"
      class="close"
      data-dismiss="modal"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="form">
      <div class="row">
        <mat-form-field class="col-md-6" appearance="outline">
          <mat-label>Tipo de contrato</mat-label>
          <mat-select
            formControlName="type_contract"
            id="type_contract"
            (selectionChange)="changeType()"
            required
          >
            <mat-option
              *ngFor="let contract_type of contract_types"
              [value]="contract_type.value"
            >
              {{ contract_type.text }}</mat-option
            >
          </mat-select>
          <mat-error *ngIf="type_contract_valid"> Campo obligatorio </mat-error>
        </mat-form-field>
        <mat-form-field class="col-md-6" appearance="outline">
          <mat-label>Salario</mat-label>
          <input
            matInput
            type="number"
            pattern="([0-9]{1,3}).([0-9]{1,3})"
            placeholder="Ingresa el salario"
            formControlName="salary"
            id="funcionario_id"
            required
            autocomplete="off"
          />
          <mat-error *ngIf="salary_valid"> Campo obligatorio </mat-error>
        </mat-form-field>
        <mat-form-field class="col-md-6" appearance="outline">
          <mat-label>Fecha de ingreso</mat-label>
          <input
            matInput
            type="date"
            formControlName="date_of_admission"
            id="fecha_ingreso"
            required
          />
          <mat-error *ngIf="date_of_admission_valid">
            Campo obligatorio
          </mat-error>
        </mat-form-field>
        <mat-form-field
          class="col-md-6"
          appearance="outline"
          *ngIf="form.get('type_contract').value == 2"
        >
          <mat-label>Fecha de retiro</mat-label>
          <input
            matInput
            type="date"
            formControlName="date_end"
            id="fecha_retiro"
            required
          />
          <mat-error *ngIf="retirement_date_valid">
            Campo obligatorio
          </mat-error>
        </mat-form-field>
        <mat-checkbox class="col-md-12" id="flexCheckDefault" color="primary"
          >¿Pagar auxilio?</mat-checkbox
        >
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-danger"
      (click)="modal.dismiss('Cross click')"
    >
      Cancelar
    </button>
    <button
      type="button"
      (click)="updateSalaryInfo()"
      [disabled]="!form.valid"
      class="btn btn-primary"
    >
      Actualizar
    </button>
  </div>
</ng-template>
