<div class="row">
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title text-primary">Por asignar</h5>
        <hr class="line" />
        <div class="d-flex justify-content-end mb-1">
          <small
            role="button"
            class="text-info"
            (click)="
              orderBy == 'asc' ? (orderBy = 'desc') : (orderBy = 'asc');
              getInicial()
            "
          >
            <i
              class="fas"
              [class]="
                orderBy == 'asc' ? 'fa-sort-amount-up' : 'fa-sort-amount-down'
              "
            ></i>
            {{
              orderBy == "asc"
                ? "Fecha de entrega (asc)"
                : "Fecha de entrega (desc)"
            }}
          </small>
        </div>
        <ng-container
          *ngIf="!loading_stage && work_orders.length > 0; else notData"
        >
          <div class="list-group">
            <a
              *ngFor="let item of work_orders"
              href="javascript:void(0)"
              (click)="openModal(forStageModal, item)"
              class="list-group-item list-group-item-action flex-column align-items-start list-group-item-light"
            >
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">
                  <i class="fas fa-tools"></i> {{ item.code }}
                </h5>
                <small>{{ item.delivery_date | date }}</small>
              </div>
              <p class="mb-1">
                <b><i class="fas fa-building"></i> Empresa:</b>
                {{ item.third_party.text | titlecase }} <br />
                <b><i class="fas fa-user-alt"></i> Persona:</b>
                {{ item.third_party_person.name | titlecase }}
              </p>
              <small
                ><i class="fas fa-map-marker"></i>
                {{ item.city.name | titlecase }}</small
              >
            </a>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title text-center text-primary">Seguimiento</h5>
        <p class="card-text">Content</p>
      </div>
    </div>
  </div>
</div>

<ng-template #notData>
  <app-not-data [loading]="loading_stage"></app-not-data>
</ng-template>

<ng-template #forStageModal let-modal>
  <div class="modal-header">
    <h4 class="text-primary modal-title">Asignar orden de trabajo</h4>
    <button
      type="button"
      class="close"
      data-dismiss="modal"
      aria-label="Close"
      (click)="_modal.close()"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <ng-container [formGroup]="form_assign">
      <div class="row">
        <mat-form-field class="col-md-4" appearance="outline">
          <mat-label>Dependencia</mat-label>
          <mat-select formControlName="dependency_id" required>
            <mat-option
              *ngFor="let item of dependencies"
              [value]="item.value"
              >{{ item.text }}</mat-option
            >
          </mat-select>
          <mat-error>Campo obligatorio</mat-error>
        </mat-form-field>
        <mat-form-field class="col-md-4" appearance="outline">
          <mat-label>Funcionario</mat-label>
          <input
            matInput
            type="text"
            formControlName="person_id"
            [ngbTypeahead]="search_person"
            [inputFormatter]="formatter_person"
            [resultFormatter]="formatter_person"
            [editable]="false"
            placeholder="Busca funcionario"
            required
          />
          <mat-error>Campo obligatorio</mat-error>
        </mat-form-field>
        <mat-form-field class="col-md-2" appearance="outline">
          <mat-label>Horas</mat-label>
          <input
            matInput
            type="number"
            autocomplete="off"
            formControlName="hours"
            required
          />
          <mat-error>Obligatorio</mat-error>
        </mat-form-field>
        <mat-form-field class="col-md-2" appearance="outline">
          <mat-label>Minutos</mat-label>
          <input
            matInput
            type="number"
            autocomplete="off"
            formControlName="minutes"
            required
          />
          <mat-error>Obligatorio</mat-error>
        </mat-form-field>
        <mat-form-field
          class="col-md-12 mat-form-field-no-padding textarea"
          appearance="outline"
        >
          <mat-label>Observaciones</mat-label>
          <textarea
            matInput
            placeholder="Ingresa las observaciones"
            rows="5"
            required
            formControlName="observations"
            [cdkTextareaAutosize]="true"
          ></textarea>
          <mat-hint>Max. 500 caracteres</mat-hint>
          <mat-error>Campo obligatorio</mat-error>
        </mat-form-field>
      </div>
    </ng-container>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="_modal.close()">
      Cancelar
    </button>
    <button type="button" (click)="assign()" class="btn btn-primary">
      Asignar
    </button>
  </div>
</ng-template>
