<div class="card">
  <div class="card-body">
    <div class="card-title d-flex justify-content-between">
      <img src="assets/images/logo2.png" alt="" height="45" />
      <app-cabecera [datosCabecera]="datosCabecera"></app-cabecera>
    </div>
    <hr class="line" />
    <form #FormActivoFijo="ngForm">
      <div class="row">
        <mat-form-field class="col" appearance="outline">
          <mat-label>Fecha</mat-label>
          <input
            matInput
            type="date"
            name="fecha"
            id="fecha"
            [(ngModel)]="ActivoFijoModel.Fecha"
            (change)="getCodigo($event.target.value)"
            autocomplete="off"
          />
        </mat-form-field>
        <mat-form-field class="col" appearance="outline">
          <mat-label>NIT</mat-label>
          <input
            matInput
            name="nit_empresa"
            id="nit_empresa"
            (change)="AsignarTercero()"
            (blur)="validarCampo(TerceroSeleccionado, $event, 'NIT')"
            [(ngModel)]="TerceroSeleccionado"
            type="text"
            placeholder="Ingresa nombre o NIT"
            [ngbTypeahead]="search_tercero"
            required
            [resultTemplate]="rt_tercero"
            [inputFormatter]="formatter_tercero"
            autocomplete="off"
          />
        </mat-form-field>
        <mat-form-field class="col" appearance="outline">
          <mat-label>Nombre de activo</mat-label>
          <input
            matInput
            type="text"
            class="text-uppercase"
            name="Nombre"
            id="nombre"
            placeholder="Ingresa nombre de activo"
            (change)="AsignarConcepto()"
            required
            [(ngModel)]="ActivoFijoModel.Nombre"
          />
        </mat-form-field>
        <mat-form-field class="col" appearance="outline">
          <mat-label>Documento</mat-label>
          <input
            matInput
            type="text"
            class="text-uppercase"
            name="documento"
            placeholder="Ingresa documento"
            id="documento"
            (change)="AsignarConcepto()"
            [(ngModel)]="ActivoFijoModel.Documento"
          />
        </mat-form-field>
        <mat-form-field class="col" appearance="outline">
          <mat-label>Concepto</mat-label>
          <input
            matInput
            type="text"
            class="text-uppercase"
            name="concepto"
            id="concepto"
            [(ngModel)]="ActivoFijoModel.Concepto"
            readonly
          />
        </mat-form-field>
        <mat-form-field class="col" appearance="outline" *ngIf="Crear">
          <mat-label>Tipo de activo</mat-label>
          <mat-select
            name="Id_Tipo_Activo_Fijo"
            id="tipo_activo"
            required
            [(ngModel)]="ActivoFijoModel.Id_Tipo_Activo_Fijo"
          >
            <mat-option
              *ngFor="let ta of TipoActivos"
              [value]="ta.Id_Tipo_Activo_Fijo"
            >
              {{ ta.Nombre_Tipo_Activo }}</mat-option
            >
          </mat-select>
        </mat-form-field>
        <mat-form-field class="col" appearance="outline" *ngIf="!Crear">
          <mat-label>Tipo de activo</mat-label>
          <input
            matInput
            type="text"
            name="Tipo_activo"
            id="Tipo_Activo"
            [(ngModel)]="ActivoFijoModel.Tipo_Activo"
            readonly
            class="text-uppercase"
          />
        </mat-form-field>
      </div>
      <div class="form-row mb-2 f-10">
        <div class="col-md-3" *ngIf="Crear">
          <div class="form-group">
            <label for="tipo_activo">C. Costo</label>
            <app-custumetypeahead
              [Ruta]="Ruta"
              [Modelo]="typeahead"
              [Campo]="Campo_Centro_Costo"
              (RetornarId)="CapturarIdCentroCosto($event, 'Centro')"
            ></app-custumetypeahead>
          </div>
        </div>
        <div class="col-md-3" *ngIf="!Crear">
          <div class="form-group">
            <label for="tipo_activo">C. Costo</label>
            <input
              style="text-transform: uppercase"
              type="text"
              name="Centro_Costo"
              id="Centro_Costo"
              [(ngModel)]="ActivoFijoModel.Centro_Costo"
              readonly
              class="form-control form-control-sm"
            />
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="referencia">Referencia</label>
            <input
              type="text"
              class="form-control form-control-sm"
              name="referencia"
              id="referencia"
              [(ngModel)]="ActivoFijoModel.Referencia"
            />
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="cantidad">Cantidad</label>
            <input
              type="text"
              class="form-control form-control-sm"
              name="cantidad"
              id="cantidad"
              required
              [(ngModel)]="ActivoFijoModel.Cantidad"
            />
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
            <label>Base</label>
            <input
              type="number"
              class="form-control form-control-sm"
              name="Base"
              required
              (change)="AsignarValor('Pcga')"
              [(ngModel)]="ActivoFijoModel.Base"
            />
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
            <label>Iva</label>
            <input
              type="number"
              class="form-control form-control-sm"
              name="Iva"
              required
              (change)="AsignarValor('Pcga')"
              [(ngModel)]="ActivoFijoModel.Iva"
            />
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
            <label>Base NIIF</label>
            <input
              type="number"
              class="form-control form-control-sm"
              name="Base"
              required
              (change)="AsignarValor('Niif')"
              [(ngModel)]="ActivoFijoModel.Base_NIIF"
            />
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
            <label>Iva NIIF</label>
            <input
              type="number"
              class="form-control form-control-sm"
              name="Iva"
              required
              (change)="AsignarValor('Niif')"
              [(ngModel)]="ActivoFijoModel.Iva_NIIF"
            />
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label>Costo PCGA(Local)</label>
            <input
              type="number"
              class="form-control form-control-sm"
              name="Costo_PCGA"
              readonly
              [(ngModel)]="ActivoFijoModel.Costo_PCGA"
            />
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label>Costo NIIF</label>
            <input
              type="number"
              class="form-control form-control-sm"
              name="Costo_NIIF"
              readonly
              [(ngModel)]="ActivoFijoModel.Costo_NIIF"
            />
          </div>
        </div>

        <!-- <div class="col-md-6">
          <div class="form-group">
            <label for="tipo_activo">Contrapartida</label>
            <app-custumetypeahead
              [Ruta]="Ruta_Cuentas"
              [Modelo]="typeahead_Cuenta"
              (RetornarId)="CapturarIdCentroCosto($event, 'Contrapartida')"
              [Campo]="Campo_Contrapartida"
            ></app-custumetypeahead>
          </div>
        </div> -->

        <div class="col-md-2">
          <div class="form-group">
            <label for="tipo_activo">Cuenta Rte Fte</label>
            <app-custumetypeahead
              [Ruta]="Ruta_Cuenta_Renteciones"
              [Modelo]="typeahead_Rete_Fuente"
              (RetornarId)="CapturarIdCentroCosto($event, 'Rete_Fuente')"
              [Campo]="Campo_Rete_Fuente"
            ></app-custumetypeahead>
          </div>
        </div>
        <div class="col-md-4">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="tipo_activo">Valor</label
                ><input
                  type="number"
                  class="form-control form-control-sm"
                  name="Costo_Rete_Fuente"
                  readonly
                  [(ngModel)]="ActivoFijoModel.Costo_Rete_Fuente"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="tipo_activo">Valor NIIF</label
                ><input
                  type="number"
                  class="form-control form-control-sm"
                  name="Costo_Rete_Fuente_NIIF"
                  readonly
                  [(ngModel)]="ActivoFijoModel.Costo_Rete_Fuente_NIIF"
                />
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label for="tipo_activo">Cuenta Rte Ica</label>
            <app-custumetypeahead
              [Ruta]="Ruta_Cuenta_Renteciones"
              [Modelo]="typeahead_Rete_Ica"
              (RetornarId)="CapturarIdCentroCosto($event, 'Rete_Ica')"
              [Campo]="Campo_Rete_Ica"
            ></app-custumetypeahead>
          </div>
        </div>
        <div class="col-md-4">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="tipo_activo">Valor</label
                ><input
                  type="number"
                  class="form-control form-control-sm"
                  name="Costo_Rete_Ica"
                  readonly
                  [(ngModel)]="ActivoFijoModel.Costo_Rete_Ica"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="tipo_activo">Valor NIIF</label
                ><input
                  type="number"
                  class="form-control form-control-sm"
                  name="Costo_Rete_Ica_NIIF"
                  readonly
                  [(ngModel)]="ActivoFijoModel.Costo_Rete_Ica_NIIF"
                />
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="Mostrar_Facturas" class="col-md-12">
          <div class="row">
            <div class="col-md-12 text-center">
              <h6>Facturas</h6>
            </div>
            <div class="col-md-12" style="max-height: 400px; overflow: auto">
              <table class="table invoice-detail-table tabla">
                <thead>
                  <tr class="thead-default">
                    <th style="width: 25px"></th>
                    <th style="width: 50px">Cuenta</th>
                    <th style="width: 50px">Fecha</th>
                    <th style="width: 60px">Documento</th>
                    <th style="width: 80px; text-align: right">Vlr. Factura</th>
                    <th style="width: 80px; text-align: right">Vlr. Abono</th>
                    <th style="width: 80px; text-align: right">Vlr. Saldo</th>
                    <th style="width: 80px; text-align: right">Abono</th>
                    <th style="width: 20px">Nat</th>
                    <th style="width: 60px; text-align: right">
                      Movimiento Debito
                    </th>
                    <th style="width: 60px; text-align: right">
                      Movimiento_Credito
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngIf="Lista_Facturas.length == 0 && !Cargando">
                    <td colspan="11">
                      <i class="fa fa-exclamation-circle fa-5x"></i>
                      <h4>No Existen Facturas para mostrar</h4>
                    </td>
                  </tr>
                  <tr
                    *ngFor="let item of Lista_Facturas; let i = index"
                    id="fila{{ i }}"
                  >
                    <td style="width: 25px" class="text-center">
                      <input
                        type="checkbox"
                        name="Factura{{ i }}"
                        id="Factura{{ i }}"
                        (change)="addListInvoice(item, i)"
                      />
                    </td>
                    <td style="width: 50px">{{ item.Codigo }}</td>
                    <td style="width: 50px">{{ item.Fecha }}</td>
                    <td style="width: 60px">{{ item.Factura }}</td>
                    <td style="width: 80px; text-align: right">
                      {{ item.Valor_Factura | currency }}
                    </td>
                    <td style="width: 80px; text-align: right">
                      {{ item.Valor_Abono | currency }}
                    </td>
                    <td style="width: 80px; text-align: right">
                      {{ item.Valor_Saldo | currency }}
                    </td>
                    <td style="width: 80px; text-align: right">
                      <input
                        type="number"
                        name="abono{{ i }}"
                        id="abono{{ i }}"
                        [(ngModel)]="item.Abono"
                        (blur)="validarSaldoFactura(i, $event)"
                      />
                    </td>
                    <td style="width: 20px">{{ item.Nat }}</td>
                    <td style="width: 60px; text-align: right">
                      {{ item.Movimiento_Debito | currency }}
                    </td>
                    <td style="width: 60px; text-align: right">
                      {{ item.Movimiento_Credito | currency }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <button
            class="btn btn-info btn-sm pull-left"
            (click)="addInvoicesToAccount()"
          >
            Confirmar
          </button>
        </div>

        <div class="col-md-6">
          <h5>Anticipo</h5>
          <hr />
          <div *ngFor="let item of Ctas_Anticipo; let i = index" class="row">
            <div class="col-md-3">
              <label for="tipo_activo">Cuenta Anticipo</label>
              <app-custumetypeahead
                [Ruta]="Ruta_Cuentas"
                [Modelo]="{
                  placeholder: 'Cta Anticipo',
                  name: 'Cta_Anticipo' + i,
                  id: 'Cta_Anticipo' + i,
                  Requerido: false
                }"
                (RetornarId)="CapturarIdCentroCosto($event, 'Anticipo', i)"
                [Campo]="item.Cta_Anticipo"
              ></app-custumetypeahead>
            </div>
            <div class="col-md-2">
              <label for="tipo_activo">Nit</label>
              <app-custumetypeahead
                [Ruta]="Ruta_Nit"
                [Modelo]="{
                  placeholder: 'Nombre o Nit',
                  name: 'Nit' + i,
                  id: 'Nit' + i,
                  Requerido: false
                }"
                (RetornarId)="CapturarIdCentroCosto($event, 'Nit_Anticipo', i)"
                [Campo]="item.Nit_Anticipo"
              ></app-custumetypeahead>
            </div>
            <div style="padding: 0px" class="col-md-2">
              <label for="tipo_activo">Documento</label>
              <input
                type="text"
                name="documento_anticipo{{ i }}"
                class="form-control form-control-sm input-document"
                id="documento_anticipo{{ i }}"
                [(ngModel)]="item.Documento"
              />
              <a
                style="margin: 0px"
                href="javascript:;"
                (click)="showFacturas(i)"
              >
                <i style="font-weight: bold" class="fa fa-search"></i>
              </a>
            </div>
            <div class="col-md-3">
              <label for="tipo_activo">Concepto</label>
              <input
                type="text"
                name="detalles{{ i }}"
                class="form-control form-control-sm input-document"
                id="detalles{{ i }}"
                [(ngModel)]="item.Detalles"
              />
            </div>
            <div class="col-md-2">
              <label for="tipo_activo">Valor</label>
              <br />
              <input
                style="
                  width: 65%;
                  margin-right: 0 !important;
                  display: inline-block;
                "
                type="number"
                name="valor_anticipo{{ i }}"
                class="form-control form-control-sm"
                id="valor_anticipo{{ i }}"
                [(ngModel)]="item.Valor"
                (change)="calcularTotales()"
              />
              <span
                ><button
                  *ngIf="Ctas_Anticipo.length - 1 != i"
                  style="padding: 0px !important; margin: 0px !important"
                  class="btn btn-link btn-sm text-danger"
                  (click)="deleteRowCtaAnticipo(i)"
                >
                  <i class="fa fa-trash"></i></button
              ></span>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <h5>Por Pagar</h5>
          <hr />
          <div class="row">
            <div class="col-md-3">
              <label for="tipo_activo">Cta x Pagar</label>
              <app-custumetypeahead
                [Ruta]="Ruta_Cuentas"
                [Modelo]="typeahead_CuentaXPagar"
                (RetornarId)="CapturarIdCentroCosto($event, 'CxP')"
                [Campo]="Campo_CtaPorPagar"
              ></app-custumetypeahead>
            </div>
            <div class="col-md-2">
              <label for="tipo_activo">Nit</label>
              <app-custumetypeahead
                [Ruta]="Ruta_Nit"
                [Modelo]="typeahead_Terceros"
                (RetornarId)="CapturarIdCentroCosto($event, 'Nit_CtaPorPagar')"
                [Campo]="Campo_NitPorPagar"
              ></app-custumetypeahead>
            </div>
            <div class="col-md-2">
              <label for="tipo_activo">Documento</label>
              <input
                type="text"
                name="documento_cta_pagar"
                class="form-control form-control-sm"
                id="documento_cta_pagar"
                [(ngModel)]="ActivoFijoModel.Documento_CtaPorPagar"
              />
            </div>
            <div class="col-md-3">
              <label for="tipo_activo">Concepto</label>
              <input
                type="text"
                name="detalles"
                class="form-control form-control-sm"
                id="detalles"
                [(ngModel)]="ActivoFijoModel.Detalles"
              />
            </div>
            <div class="col-md-2">
              <label for="tipo_activo">Valor</label>
              <input
                type="number"
                name="valor_cta_pagar"
                class="form-control form-control-sm"
                id="valor_cta_pagar"
                [(ngModel)]="ActivoFijoModel.Valor_CtaPorPagar"
                (change)="calcularTotales()"
              />
            </div>
          </div>
        </div>

        <hr />

        <div class="d-flex justify-content-end col-md-6">
          <table class="table table-hover">
            <tbody>
              <tr>
                <th>Total Debito:</th>
                <td>${{ Total_Debito | currency: "":"" }}</td>
              </tr>

              <tr>
                <th>Total Credito:</th>
                <td>${{ Total_Credito | currency: "":"" }}</td>
              </tr>

              <tr>
                <th>Diferencia:</th>
                <td>${{ Total_Debito - Total_Credito | currency: "":"" }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="col-md-12">
          <button
            class="btn btn-primary btn-block"
            [swal]="confirmacionGuardar"
          >
            <i class="fas fa-save"></i> Guardar
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<swal #alertSwal title="" text="" icon=""></swal>

<swal #confirmacionGuardar [swalOptions]="alertOption"></swal>

<ng-template #rt_tercero let-r="result" let-t="term">
  <span class="f-9">
    {{ r.Nombre_Tercero }}
  </span>
</ng-template>
