<ng-template #placeholder>
  <app-placeholder-form></app-placeholder-form>
</ng-template>
<div class="card" *ngIf="!loading; else placeholder">
  <div class="card-body">
    <app-cabecera [datosCabecera]="datosCabecera"></app-cabecera>
    <hr class="line" />
    <form [formGroup]="form">
      <div class="row">
        <mat-form-field class="col-md-3" appearance="outline">
          <mat-label>Nombre</mat-label>
          <input
            matInput
            type="text"
            required
            placeholder="Ingresa el nombre"
            formControlName="name"
          />
        </mat-form-field>
        <div class="col-md-3 mat-form-field-wrapper">
          <ng-select
            formControlName="city_id"
            [items]="cities"
            bindLabel="text"
            appearance="outline"
            [class.is-invalid]="form.get('city_id').invalid"
            [appendTo]="'body'"
            placeholder="Destino *"
            bindValue="value"
            loadingText="loading"
            ngDefaultControl
          >
          </ng-select>
        </div>
        <div class="col-md-3 mat-form-field-wrapper">
          <ng-select
            formControlName="third_party_id"
            [items]="clients"
            bindLabel="text"
            appearance="outline"
            [appendTo]="'body'"
            [class.is-invalid]="form.get('third_party_id').invalid"
            placeholder="Cliente *"
            bindValue="value"
            loadingText="loading"
            ngDefaultControl
          >
          </ng-select>
        </div>
        <mat-form-field class="col-md-3" appearance="outline">
          <mat-label>Línea</mat-label>
          <input
            matInput
            type="text"
            required
            placeholder="Ingresa la línea"
            formControlName="line"
          />
        </mat-form-field>
        <mat-form-field
          class="col-md-12 mat-form-field-no-padding textarea"
          appearance="outline"
        >
          <mat-label>Observaciones</mat-label>
          <textarea
            matInput
            placeholder="Ingrese las observaciones"
            rows="5"
            formControlName="observation"
            [cdkTextareaAutosize]="true"
          ></textarea>
        </mat-form-field>
      </div>
      <h5 class="mt-2 text-center">Costos directos</h5>
      <hr class="line" />
      <app-planos-conjunto
        *ngIf="planos.length > 0 && title == 'Editar conjunto'"
        (actualizar)="refreshData()"
        [data]="planos"
        [info]="'editar'"
      ></app-planos-conjunto>
      <h6>Subir planos</h6>
      <ngx-dropzone
        class="drop-zone"
        (change)="onSelect($event)"
        accept="image/jpeg, image/jpg, image/png, application/pdf"
      >
        <ngx-dropzone-label>
          <span><i class="fas fa-cloud-download-alt"></i></span> Arrastre y
          suelte el archivo
        </ngx-dropzone-label>
        <ngx-dropzone-preview
          *ngFor="let f of files"
          [removable]="true"
          (removed)="onRemove(f)"
        >
          <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
        </ngx-dropzone-preview>
      </ngx-dropzone>
      <h6 class="mt-3">Listado de piezas</h6>
      <div class="alert alert-warning" role="alert">
        Todas las piezas deben estar ligadas a un APU existente
      </div>
      <ng-container *ngIf="piecesSetsList.controls.length; else notData">
        <div class="rounded-top">
          <table class="table table-bordered table-striped table-sm">
            <thead class="bg-light">
              <tr class="text-center text-uppercase">
                <th class="align-middle">Item</th>
                <th class="align-middle">Tipo</th>
                <th class="align-middle">Descripción</th>
                <th class="align-middle">Unidad</th>
                <th class="align-middle">Cantidad</th>
                <th class="align-middle">Costo Unitario</th>
                <th class="align-middle">Total</th>
                <th class="align-middle">
                  <i class="fas fa-trash-alt"></i>
                </th>
              </tr>
            </thead>
            <tbody formArrayName="list_pieces_sets">
              <ng-container
                *ngFor="let item of piecesSetsList.controls; let i = index"
              >
                <tr [formGroupName]="i" class="text-center">
                  <td class="align-middle">
                    {{ i + 1 }}
                  </td>
                  <td class="align-middle">
                    <select
                      *ngIf="
                        !item.get('apu_part_id').value &&
                          !item.get('apu_set_child_id').value;
                        else apuType
                      "
                      class="form-control form-control-sm"
                      id="descripcion"
                      formControlName="apu_type"
                    >
                      <option value="P">Pieza</option>
                      <option value="C">Conjunto</option>
                    </select>
                    <ng-template #apuType>
                      {{
                        item.controls.apu_type.value == "P"
                          ? "Pieza"
                          : item.controls.apu_type.value == "C"
                          ? "Conjunto"
                          : ""
                      }}
                    </ng-template>
                  </td>
                  <td class="align-middle">
                    <div class="position-relative">
                      <input
                        *ngIf="
                          item['controls']['apu_type']['value'] == 'P' &&
                          !item.get('apu_part_id').value
                        "
                        style="min-width: 13rem"
                        id="typeahead-http"
                        type="text"
                        class="form-control form-control-sm"
                        [ngbTypeahead]="search"
                        [resultTemplate]="rt"
                        [inputFormatter]="formatter"
                        placeholder="Escribe para buscar pieza"
                        formControlName="description"
                        (change)="select(item, 'description', 'apu_part_id')"
                      />
                      <input
                        *ngIf="
                          item['controls']['apu_type']['value'] == 'C' &&
                          !item.get('apu_set_child_id').value
                        "
                        style="min-width: 13rem"
                        id="typeahead-httpp"
                        type="text"
                        class="form-control form-control-sm"
                        [ngbTypeahead]="searchSet"
                        [resultTemplate]="rt"
                        [inputFormatter]="formatterSet"
                        placeholder="Escribe para buscar conjunto"
                        formControlName="description"
                        (change)="
                          select(item, 'description', 'apu_set_child_id')
                        "
                      />
                    </div>
                    <ng-container
                      *ngIf="
                        item.get('apu_part_id').value ||
                        item.get('apu_set_child_id').value
                      "
                    >
                      {{ item.get("description").value.name }}
                    </ng-container>
                    <!-- <ng-select
                      [items]="apuPart$ | async"
                      bindLabel="name"
                      bindValue="id"
                      [loading]="apuPartLoading"
                      [typeahead]="apuPartInput$"
                      typeToSearchText="Por favor para buscar"
                      formControlName="apu_part_id"
                    >
                    </ng-select> -->
                  </td>
                  <!-- <td>
                    <ng-select
                      [items]="apuSets$ | async"
                      bindLabel="name"
                      bindValue="id"
                      [loading]="apuSetsLoading"
                      [typeahead]="apuSetsInput$"
                      typeToSearchText="Por favor para buscar"
                      formControlName="apu_set_child_id"
                    >
                    </ng-select>
                  </td> -->
                  <td class="align-middle">
                    <select
                      class="form-control form-control-sm"
                      formControlName="unit_id"
                    >
                      <option value="" disabled selected hidden>
                        Selecciona
                      </option>
                      <option *ngFor="let item of units" [value]="item.value">
                        {{ item.text }}
                      </option>
                    </select>
                  </td>
                  <td class="align-middle">
                    <input
                      currencyMask
                      [options]="masksMoney.maskNumbers"
                      class="form-control form-control-sm"
                      id="costo_unitario_maquinas_herra"
                      formControlName="amount"
                    />
                  </td>
                  <td class="align-middle">
                    ${{ item.controls.unit_cost.value | number : "1.2-2" }}
                  </td>
                  <td class="align-middle">
                    ${{ item.controls.total.value | number : "1.2-2" }}
                  </td>
                  <td class="align-middle">
                    <button
                      style="float: right"
                      class="btn btn-danger btn-sm"
                      placement="bottom"
                      type="button"
                      ngbTooltip="Borrar"
                      (click)="deletePiecesSets(i)"
                    >
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
        <div class="row d-flex justify-content-end">
          <div class="col-md-4">
            <h6 class="d-flex justify-content-between">
              Subtotal
              <span class="badge badge-success badge-pill"
                >${{
                  this.form.get("list_pieces_sets_subtotal").value
                    | number : "1.2-2"
                }}</span
              >
            </h6>
          </div>
        </div>
      </ng-container>
      <div class="d-flex justify-content-end">
        <div class="btn-group">
          <button
            class="btn btn-primary btn-sm"
            placement="bottom"
            type="button"
            ngbTooltip="Agregar"
            (click)="newPiecesSets()"
          >
            <i class="fas fa-plus"></i>
          </button>
          <button
            class="btn btn-info btn-sm"
            placement="bottom"
            type="button"
            ngbTooltip="Agregar item"
            (click)="findApus()"
          >
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
      <hr />
      <h6 class="mt-3">Máquinas herramientas</h6>
      <ng-container *ngIf="machineToolList.controls.length; else notData">
        <div class="rounded-top table-responsive">
          <table class="table table-bordered table-striped table-sm">
            <thead class="bg-light">
              <tr class="text-center text-uppercase">
                <th class="align-middle">Item</th>
                <th class="align-middle">Descripción</th>
                <th class="align-middle">Unidad</th>
                <th class="align-middle col-1">Cantidad</th>
                <th class="align-middle">Costo Unitario</th>
                <th class="align-middle">Total</th>
                <th class="align-middle">
                  <i class="fas fa-trash-alt"></i>
                </th>
              </tr>
            </thead>
            <tbody formArrayName="machine_tools">
              <ng-container
                *ngFor="let item of machineToolList.controls; let i = index"
              >
                <tr [formGroupName]="i" class="text-center">
                  <td class="align-middle">
                    {{ i + 1 }}
                  </td>
                  <td class="align-middle">
                    {{ item.value.name_description }}
                    <!-- <select
                      class="form-control form-control-sm"
                      formControlName="description"
                      (change)="machineSet(item, $event)"
                    >
                      <option value="" disabled selected hidden>
                        Selecciona
                      </option>
                      <option
                        *ngFor="let maquina of maquinas_herramientas"
                        [value]="maquina.value"
                      >
                        {{ maquina.text }}
                      </option>
                    </select> -->
                  </td>
                  <td class="align-middle">
                    {{ item.value.unit_name }}
                    <!-- <select
                      class="form-control form-control-sm"
                      formControlName="unit_id"
                    >
                      <option value="" disabled selected hidden>
                        Selecciona
                      </option>
                      <option *ngFor="let item of units" [value]="item.value">
                        {{ item.text }}
                      </option>
                    </select> -->
                  </td>
                  <td class="align-middle">
                    <input
                      currencyMask
                      [options]="masksMoney.maskNumbers"
                      class="form-control form-control-sm"
                      id="costo_unitario_maquinas_herra"
                      formControlName="amount"
                    />
                  </td>
                  <td class="align-middle">
                    ${{ item.value.unit_cost | number : "1.2-2" }}
                    <!-- <input
                      currencyMask
                      [options]="masksMoney.maskCOP"
                      class="form-control form-control-sm"
                      id="costo_unitario_maquinas_herra"
                      formControlName="unit_cost"
                    /> -->
                  </td>
                  <td class="align-middle">
                    ${{ item.value.total | number : "1.2-2" }}
                    <!-- <input
                      currencyMask
                      [options]="masksMoney.maskCOP"
                      class="form-control form-control-sm"
                      id="total_maquinas_herra"
                      formControlName="total"
                    /> -->
                  </td>
                  <td class="align-middle">
                    <button
                      class="btn btn-danger btn-sm"
                      placement="bottom"
                      type="button"
                      ngbTooltip="Borrar"
                      (click)="deleteMachineTool(i)"
                    >
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
        <div class="row d-flex justify-content-end">
          <div class="col-md-4">
            <h6 class="d-flex justify-content-between">
              Subtotal
              <span class="badge badge-success badge-pill"
                >${{
                  this.form.get("machine_tools_subtotal").value
                    | number : "1.2-2"
                }}</span
              >
            </h6>
          </div>
        </div>
      </ng-container>
      <div class="d-flex justify-content-end">
        <button
          class="btn btn-primary btn-sm"
          placement="bottom"
          type="button"
          ngbTooltip="Agregar"
          (click)="newMachineTool()"
        >
          <i class="fas fa-plus"></i>
        </button>
      </div>
      <hr />
      <h6 class="mt-3">Procesos internos</h6>
      <ng-container *ngIf="internalProcessList.controls.length; else notData">
        <div class="rounded-top table-responsive">
          <table class="table table-bordered table-striped table-sm">
            <thead class="bg-light">
              <tr class="text-center text-uppercase">
                <th class="align-middle">Item</th>
                <th class="align-middle">Descripción</th>
                <th class="align-middle">Unidad</th>
                <th class="align-middle col-1">Cantidad</th>
                <th class="align-middle">Costo Unitario</th>
                <th class="align-middle">Total</th>
                <th class="align-middle">
                  <i class="fas fa-trash-alt"></i>
                </th>
              </tr>
            </thead>
            <tbody formArrayName="internal_processes">
              <ng-container
                *ngFor="let item of internalProcessList.controls; let i = index"
              >
                <tr [formGroupName]="i" class="text-center">
                  <td class="align-middle">{{ i + 1 }}</td>
                  <td class="align-middle">
                    {{ item.value.name_description }}
                    <!-- <select
                      class="form-control form-control-sm"
                      formControlName="description"
                      (change)="internalSet(item, $event)"
                    >
                      <option value="" disabled selected hidden>
                        Selecciona
                      </option>
                      <option
                        *ngFor="let interno of procesos_internos"
                        [value]="interno.value"
                      >
                        {{ interno.text }}
                      </option>
                    </select> -->
                  </td>
                  <td class="align-middle">
                    {{ item.value.unit_name }}
                    <!-- <select
                      class="form-control form-control-sm"
                      formControlName="unit_id"
                    >
                      <option value="" disabled selected hidden>
                        Selecciona
                      </option>
                      <option *ngFor="let item of units" [value]="item.value">
                        {{ item.text }}
                      </option>
                    </select> -->
                  </td>
                  <td class="align-middle">
                    <input
                      currencyMask
                      [options]="masksMoney.maskNumbers"
                      class="form-control form-control-sm"
                      id="costo_unitario_proceso_interno"
                      formControlName="amount"
                    />
                  </td>
                  <td class="align-middle">
                    ${{ item.value.unit_cost | number : "1.2-2" }}
                    <!-- <input
                      currencyMask
                      [options]="masksMoney.maskCOP"
                      class="form-control form-control-sm"
                      id="costo_unitario_proceso_interno"
                      formControlName="unit_cost"
                    /> -->
                  </td>
                  <td class="align-middle">
                    ${{ item.value.total | number : "1.2-2" }}
                    <!-- <input
                      currencyMask
                      [options]="masksMoney.maskCOP"
                      class="form-control form-control-sm"
                      id="total_proceso_interno"
                      formControlName="total"
                    /> -->
                  </td>
                  <td class="align-middle">
                    <button
                      class="btn btn-danger btn-sm"
                      placement="bottom"
                      type="button"
                      ngbTooltip="Borrar"
                      (click)="deleteInternalProccess(i)"
                    >
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
        <div class="row d-flex justify-content-end">
          <div class="col-md-4">
            <h6 class="d-flex justify-content-between">
              Subtotal
              <span class="badge badge-success badge-pill"
                >${{
                  this.form.get("internal_processes_subtotal").value
                    | number : "1.2-2"
                }}</span
              >
            </h6>
          </div>
        </div>
      </ng-container>
      <div class="d-flex justify-content-end">
        <button
          class="btn btn-primary btn-sm"
          placement="bottom"
          type="button"
          ngbTooltip="Agregar"
          (click)="newInternalProccesses()"
        >
          <i class="fas fa-plus"></i>
        </button>
      </div>
      <hr />
      <h6 class="mt-3">Procesos externos</h6>
      <ng-container *ngIf="externalProcessList.controls.length; else notData">
        <div class="rounded-top table-responsive">
          <table class="table table-bordered table-striped table-sm">
            <thead class="bg-light">
              <tr class="text-center text-uppercase">
                <th class="align-middle">Item</th>
                <th class="align-middle">Descripción</th>
                <th class="align-middle">Unidad</th>
                <th class="align-middle col-1">Cantidad</th>
                <th class="align-middle">Costo Unitario</th>
                <th class="align-middle">Total</th>
                <th class="align-middle">
                  <i class="fas fa-trash-alt"></i>
                </th>
              </tr>
            </thead>
            <tbody formArrayName="external_processes">
              <ng-container
                *ngFor="let item of externalProcessList.controls; let i = index"
              >
                <tr [formGroupName]="i" class="text-center">
                  <td class="align-middle">
                    {{ i + 1 }}
                  </td>
                  <td class="align-middle">
                    {{ item.value.name_description }}
                    <!--  <select
                      class="form-control form-control-sm"
                      formControlName="description"
                      (change)="externalSet(item, $event)"
                    >
                      <option value="" disabled selected hidden>
                        Selecciona
                      </option>
                      <option
                        *ngFor="let externo of procesos_externos"
                        [value]="externo.value"
                      >
                        {{ externo.text }}
                      </option>
                    </select> -->
                  </td>
                  <td class="align-middle">
                    {{ item.value.unit_name }}
                    <!-- <select
                      class="form-control form-control-sm"
                      formControlName="unit_id"
                    >
                      <option value="" disabled selected hidden>
                        Selecciona
                      </option>
                      <option *ngFor="let item of units" [value]="item.value">
                        {{ item.text }}
                      </option>
                    </select> -->
                  </td>
                  <td class="align-middle">
                    <input
                      currencyMask
                      [options]="masksMoney.maskNumbers"
                      class="form-control form-control-sm"
                      id="q_unitaria_proceso_externo"
                      formControlName="amount"
                    />
                  </td>
                  <td class="align-middle">
                    ${{ item.value.unit_cost | number : "1.2-2" }}
                    <!-- <input
                      currencyMask
                      [options]="masksMoney.maskCOP"
                      class="form-control form-control-sm"
                      id="costo_unitario_proceso_externo"
                      formControlName="unit_cost"
                    /> -->
                  </td>
                  <td class="align-middle">
                    ${{ item.value.total | number : "1.2-2" }}
                    <!-- <input
                      currencyMask
                      [options]="masksMoney.maskCOP"
                      class="form-control form-control-sm"
                      id="total_proceso_externo"
                      formControlName="total"
                    /> -->
                  </td>
                  <td class="align-middle">
                    <button
                      class="btn btn-danger btn-sm"
                      placement="bottom"
                      type="button"
                      ngbTooltip="Borrar"
                      (click)="deleteExternalProccess(i)"
                    >
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
        <div class="row d-flex justify-content-end">
          <div class="col-md-4">
            <h6 class="d-flex justify-content-between">
              Subtotal
              <span class="badge badge-success badge-pill"
                >${{
                  this.form.get("external_processes_subtotal").value
                    | number : "1.2-2"
                }}</span
              >
            </h6>
          </div>
        </div>
      </ng-container>
      <div class="d-flex justify-content-end">
        <button
          class="btn btn-primary btn-sm"
          placement="bottom"
          type="button"
          ngbTooltip="Agregar"
          (click)="newExternalProccesses()"
        >
          <i class="fas fa-plus"></i>
        </button>
      </div>
      <hr />
      <a
        class="h6"
        data-toggle="collapse"
        data-target="#collapseExample"
        role="button"
        aria-expanded="false"
        (click)="otherCollapsed = !otherCollapsed"
        aria-controls="collapseExample"
      >
        <i
          class="fas"
          [class]="!otherCollapsed ? 'fa-chevron-right' : 'fa-chevron-down'"
        ></i>
        Otros
      </a>
      <div class="collapse" id="collapseExample">
        <ng-container *ngIf="othersList.controls.length; else notData">
          <div class="rounded-top table-responsive">
            <table class="table table-bordered table-striped table-sm">
              <thead class="bg-light">
                <tr class="text-center text-uppercase">
                  <th class="align-middle">Item</th>
                  <th class="align-middle">Descripción</th>
                  <th class="align-middle">Unidad</th>
                  <th class="align-middle">Cantidad</th>
                  <th class="align-middle">Costo Unitario</th>
                  <th class="align-middle">Total</th>
                  <th class="align-middle">
                    <i class="fas fa-trash-alt"></i>
                  </th>
                </tr>
              </thead>
              <tbody formArrayName="others">
                <ng-container
                  *ngFor="let item of othersList.controls; let i = index"
                >
                  <tr [formGroupName]="i" class="text-center">
                    <td class="align-middle">
                      {{ i + 1 }}
                    </td>
                    <td class="align-middle">
                      <input
                        type="text"
                        class="form-control form-control-sm"
                        id="descripcion_otros"
                        placeholder="Ingresa descripción"
                        formControlName="description"
                      />
                    </td>
                    <td class="align-middle">
                      <select
                        class="form-control form-control-sm"
                        formControlName="unit_id"
                      >
                        <option value="" disabled selected hidden>
                          Selecciona
                        </option>
                        <option *ngFor="let item of units" [value]="item.value">
                          {{ item.text }}
                        </option>
                      </select>
                    </td>
                    <td class="align-middle">
                      <input
                        currencyMask
                        [options]="masksMoney.maskNumbers"
                        class="form-control form-control-sm"
                        id="q_unitaria_otros"
                        formControlName="amount"
                      />
                    </td>
                    <td class="align-middle">
                      <input
                        currencyMask
                        [options]="masksMoney.maskCOP"
                        class="form-control form-control-sm"
                        id="costo_unitario_otros"
                        formControlName="unit_cost"
                      />
                    </td>
                    <td class="align-middle">
                      ${{ item.controls.total.value | number : "1.2-2" }}
                    </td>
                    <td class="align-middle">
                      <button
                        style="float: right"
                        class="btn btn-danger btn-sm"
                        placement="bottom"
                        type="button"
                        ngbTooltip="Borrar"
                        (click)="deleteOthers(i)"
                      >
                        <i class="fas fa-trash-alt"></i>
                      </button>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
          <div class="row d-flex justify-content-end">
            <div class="col-md-4">
              <h6 class="d-flex justify-content-between">
                Subtotal
                <span class="badge badge-success badge-pill"
                  >${{
                    this.form.get("others_subtotal").value | number : "1.2-2"
                  }}</span
                >
              </h6>
            </div>
          </div>
        </ng-container>
        <div class="d-flex justify-content-end">
          <button
            class="btn btn-primary btn-sm"
            placement="bottom"
            type="button"
            ngbTooltip="Agregar"
            (click)="newOthersList()"
          >
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </div>
      <hr />
      <div class="row d-flex justify-content-end">
        <div class="col-md-4">
          <h6 class="d-flex justify-content-between">
            COSTO DIRECTO TOTAL
            <span class="badge badge-success badge-pill"
              >${{
                this.form.get("total_direct_cost").value | number : "1.2-2"
              }}</span
            >
          </h6>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-md-6">
          <a
            class="h6"
            data-toggle="collapse"
            data-target="#collapseIndirecto"
            role="button"
            aria-expanded="true"
            (click)="indirectCollapsed = !indirectCollapsed"
            aria-controls="collapseIndirecto"
          >
            <i
              class="fas"
              [class]="
                indirectCollapsed ? 'fa-chevron-right' : 'fa-chevron-down'
              "
            ></i>
            Costos indirectos
          </a>
          <hr />
          <div class="collapse show" id="collapseIndirecto">
            <div class="rounded-top table-responsive">
              <table class="table table-borderless">
                <tbody class="text-uppercase">
                  <ng-container formArrayName="indirect_cost">
                    <ng-container
                      *ngFor="
                        let item of indirecCostList.controls;
                        let i = index
                      "
                    >
                      <tr [formGroupName]="i">
                        <td class="col-7">{{ item.controls.name.value }}</td>
                        <td class="col-2">
                          <input
                            currencyMask
                            [options]="masksMoney.maskPorcentaje"
                            step=".1"
                            class="form-control form-control-sm"
                            formControlName="percentage"
                          />
                        </td>
                        <td class="col-3 text-right">
                          ${{ item.controls.value.value | number : "1.2-2" }}
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                  <tr>
                    <th colspan="2" class="text-uppercase col-10">
                      Costos Indirectos
                    </th>
                    <td class="text-right">
                      ${{
                        form.controls.indirect_cost_total.value
                          | number : "1.2-2"
                      }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- <hr class="bg-dark"> -->
            <div class="rounded-top table-responsive">
              <table class="table table-borderless">
                <tbody class="text-uppercase">
                  <tr>
                    <td class="col-9">
                      Costos directos + costos indirectos totales
                    </td>
                    <td class="col-3 text-right">
                      ${{
                        form.controls.direct_costs_indirect_costs_total.value
                          | number : "1.2-2"
                      }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <a
            class="h6"
            data-toggle="collapse"
            data-target="#collapseAUI"
            role="button"
            aria-expanded="true"
            (click)="auiCollapsed = !auiCollapsed"
            aria-controls="collapseAUI"
          >
            <i
              class="fas"
              [class]="auiCollapsed ? 'fa-chevron-right' : 'fa-chevron-down'"
            ></i>
            AIU
          </a>
          <hr />
          <div class="collapse show" id="collapseAUI">
            <div class="rounded-top table-responsive">
              <table class="table table-borderless">
                <tbody class="text-uppercase">
                  <tr>
                    <td class="col-7">Administrativos</td>
                    <td class="col-2">
                      <input
                        currencyMask
                        [options]="masksMoney.maskPorcentaje"
                        step=".1"
                        class="form-control form-control-sm"
                        formControlName="administrative_percentage"
                      />
                    </td>
                    <td class="col-3 text-right">
                      ${{
                        form.controls.administrative_value.value
                          | number : "1.2-2"
                      }}
                    </td>
                  </tr>
                  <tr>
                    <td class="col-7">Imprevistos</td>
                    <td class="col-2">
                      <input
                        currencyMask
                        [options]="masksMoney.maskPorcentaje"
                        class="form-control form-control-sm"
                        formControlName="unforeseen_percentage"
                      />
                    </td>
                    <td class="col-3 text-right">
                      ${{
                        form.controls.unforeseen_value.value | number : "1.2-2"
                      }}
                    </td>
                  </tr>
                  <tr>
                    <td colspan="2" class="col-9">
                      SubTotal + Administrativos + Imprevistos
                    </td>
                    <td class="col-3 text-right">
                      ${{
                        form.controls.administrative_unforeseen_subtotal.value
                          | number : "1.2-2"
                      }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- <hr class="bg-dark"> -->
            <div class="rounded-top table-responsive">
              <table class="table table-borderless">
                <tbody class="text-uppercase">
                  <tr>
                    <td class="col-9">Utilidad</td>
                    <td class="col-3">
                      <input
                        currencyMask
                        [options]="masksMoney.maskPorcentaje"
                        class="form-control form-control-sm"
                        formControlName="utility_percentage"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td class="col-9">
                      SubTotal + Admin + Imprevisto + Utilidad
                    </td>
                    <td class="col-3 text-right">
                      ${{
                        form.controls.admin_unforeseen_utility_subtotal.value
                          | number : "1.2-2"
                      }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="rounded-top table-responsive">
            <table class="table table-borderless">
              <tbody>
                <tr class="text-uppercase">
                  <td class="col-9">Precio venta total COP + Retención</td>
                  <td class="col-3 text-right">
                    <h5>
                      <span class="badge badge-success">
                        $
                        {{
                          form.get("sale_price_cop_withholding_total").value
                            | number : "1.2-2"
                        }}
                      </span>
                    </h5>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- <hr class="bg-dark"> -->
          <div class="rounded-top table-responsive">
            <table class="table table-borderless">
              <tbody>
                <tr class="text-uppercase">
                  <td class="col-9">TRM</td>
                  <td class="col-3">
                    <input
                      currencyMask
                      [options]="masksMoney.maskCOP"
                      class="form-control form-control-sm"
                      formControlName="trm"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- <hr class="bg-dark"> -->
          <div class="rounded-top table-responsive">
            <table class="table table-borderless">
              <tbody>
                <tr class="text-uppercase">
                  <td class="col-9">Precio venta total USD + Retención</td>
                  <td class="col-3 text-right">
                    <h5>
                      <span class="badge badge-success">
                        USD
                        {{
                          form.get("sale_price_usd_withholding_total").value
                            | number : "1.2-2"
                        }}
                      </span>
                    </h5>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <button class="btn-block btn btn-primary" type="button" (click)="save()">
        Guardar
      </button>
    </form>
  </div>
</div>

<ng-template #notData>
  <div class="alert alert-warning text-center" role="alert">
    ¡No hay datos aquí!
  </div>
</ng-template>

<app-get-apus
  #apus
  [filter]="filters_apu"
  (sendApus)="getApus($event)"
></app-get-apus>

<ng-template #rt let-r="result" let-t="term">
  <span class="f-9">{{ r.name }} </span>
</ng-template>
<ng-template #wait>
  <div class="card">
    <div class="card-body">
      <div class="container p-4 text-center">
        <i class="fas fa-sync fa-spin fa-7x text-info"></i>
      </div>
    </div>
  </div>
</ng-template>

<app-reload-button
  [reload]="reload"
  (reloadData)="reloadData()"
></app-reload-button>
