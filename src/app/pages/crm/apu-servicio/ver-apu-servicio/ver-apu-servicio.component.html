<ng-container *ngIf="!loading; else placeholder">
  <div class="card">
    <div class="card-body">
      <app-cabecera [datosCabecera]="datosCabecera"></app-cabecera>
      <hr class="line" />
      <div class="d-flex justify-content-end">
        <div class="btn-group rounded w-sm-100">
          <button
            class="btn btn-info btn-sm"
            type="button"
            [routerLink]="['/crm/apu/editar-apu-servicio/', data.id]"
          >
            <i class="fas fa-edit"></i> Editar
          </button>
          <button
            class="btn btn-success btn-sm"
            type="button"
            [routerLink]="['/crm/apu/copiar-apu-servicio/', data.id]"
          >
            <i class="fas fa-copy"></i> Copiar
          </button>
          <button (click)="download()" class="btn btn-danger btn-sm">
            <span
              ><i
                class="fas"
                [class]="
                  !donwloading ? 'fa-file-download' : 'fa-spinner fa-spin'
                "
              ></i>
              {{ !donwloading ? "Descargar" : "Descargando" }}</span
            >
          </button>
        </div>
      </div>
      <div class="rounded-top table-responsive mt-2">
        <table class="table table-borderless text-center text-uppercase">
          <thead>
            <tr class="table-secondary">
              <th scope="row">Nombre</th>
              <th scope="row">Destino</th>
              <th scope="row">Quién elabora</th>
              <th scope="row">Cliente</th>
              <th scope="row">Línea</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ data.name }}</td>
              <td>{{ data.city.name }}</td>
              <td>{{ data.person.name }}</td>
              <td>{{ data.thirdparty.name }}</td>
              <td>{{ data.line }}</td>
            </tr>
            <tr class="text-left">
              <th colspan="100%">Observaciones</th>
            </tr>
            <tr class="text-left">
              <td colspan="100%">{{ data.observation }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <ng-container *ngIf="data.dimensional_validation.length > 0">
        <h5 class="mt-2 text-center">Validación dimensional</h5>
        <h6>Cálculo de mano de obra</h6>
        <app-validacion-dimensional
          [data]="data.dimensional_validation"
        ></app-validacion-dimensional>
        <div class="row d-flex justify-content-end">
          <div class="col-md-6">
            <div class="d-flex justify-content-between">
              <div class="rounded-top table-responsive">
                <table class="table table-hover">
                  <tbody>
                    <tr>
                      <td>SUBTOTAL MANO DE OBRA</td>
                      <td class="text-right">
                        ${{ data.subtotal_labor | number : "1.2-2" }}
                      </td>
                    </tr>
                    <tr>
                      <td>SUBTOTAL VIÁTICOS</td>
                      <td class="text-right">
                        ${{ data.subtotal_travel_expense | number : "1.2-2" }}
                      </td>
                    </tr>
                    <tr>
                      <td>SUBTOTAL VALID DIMENSIONAL</td>
                      <td class="text-right">
                        ${{
                          data.subtotal_dimensional_validation
                            | number : "1.2-2"
                        }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <ng-container *ngIf="data.assemblies_start_up.length > 0">
        <h5 class="text-center">Montaje y puesta en marcha</h5>
        <h6>Cálculo de mano de obra</h6>
        <app-montaje-puesta-marcha
          [data]="data.assemblies_start_up"
        ></app-montaje-puesta-marcha>
        <div class="row d-flex justify-content-end">
          <div class="col-md-6">
            <div class="d-flex justify-content-between">
              <div class="rounded-top table-responsive">
                <table class="table table-hover">
                  <tbody>
                    <tr>
                      <td>SUBTOTAL MANO DE OBRA</td>
                      <td class="text-right">
                        ${{ data.subtotal_labor_mpm | number : "1.2-2" }}
                      </td>
                    </tr>
                    <tr>
                      <td>SUBTOTAL VIÁTICOS</td>
                      <td class="text-right">
                        ${{
                          data.subtotal_travel_expense_mpm | number : "1.2-2"
                        }}
                      </td>
                    </tr>
                    <tr>
                      <td>SUBTOTAL MONTAJE Y PUESTA EN MARCHA</td>
                      <td class="text-right">
                        ${{
                          data.subtotal_assembly_commissioning
                            | number : "1.2-2"
                        }}
                      </td>
                    </tr>
                    <tr>
                      <td>SUBTOTAL GENERAL VIÁTICOS + MANO DE OBRA</td>
                      <td class="text-right">
                        ${{
                          data.general_subtotal_travel_expense_labor
                            | number : "1.2-2"
                        }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <h4 class="text-center">AIU</h4>
      <hr />
      <div class="d-flex justify-content-center">
        <div class="rounded-top table-responsive">
          <table
            class="table table-bordered table-striped table-sm text-center"
          >
            <tbody>
              <tr>
                <td class="text-left">Administrativos</td>
                <td>{{ data.administrative_percentage }}%</td>
                <td>${{ data.administrative_value | number : "1.2-2" }}</td>
              </tr>
              <tr>
                <td class="text-left">Imprevistos</td>
                <td>{{ data.unforeseen_percentage }}%</td>
                <td>${{ data.unforeseen_value | number : "1.2-2" }}</td>
              </tr>
              <tr>
                <td class="text-left" colspan="2">Subtotal A + I</td>
                <td>
                  ${{
                    data.subtotal_administrative_unforeseen | number : "1.2-2"
                  }}
                </td>
              </tr>
              <tr>
                <td class="text-left" colspan="2">Utilidad</td>
                <td>{{ data.utility_percentage }}%</td>
              </tr>
              <tr>
                <td class="text-left" colspan="2">SubTotal A + I + U</td>
                <td>
                  ${{
                    data.subtotal_administrative_unforeseen_utility
                      | number : "1.2-2"
                  }}
                </td>
              </tr>
              <tr>
                <td class="text-left" colspan="2">
                  Precio venta COP incluye retención
                </td>
                <td>
                  ${{
                    data.sale_price_cop_withholding_total | number : "1.2-2"
                  }}
                </td>
              </tr>
              <tr>
                <td class="text-left" colspan="2">TRM</td>
                <td>${{ data.trm | number : "1.2-2" }}</td>
              </tr>
              <tr>
                <td class="text-left" colspan="2">
                  Precio venta USD incluye retención
                </td>
                <td>${{ data.sale_price_usd_withholding_total | currency }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #placeholder>
  <app-placeholder-form></app-placeholder-form>
</ng-template>

<ng-template #notDataL>
  <app-not-data [loading]="loading"></app-not-data>
</ng-template>
<ng-template #notData>
  <tr class="bg-light">
    <td colspan="100%" class="text-center">
      <p class="text-dark">Sin datos agregados</p>
    </td>
  </tr>
</ng-template>
