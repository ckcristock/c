<div class="row">
  <div class="col-lg-7">
    <div class="card">
      <div class="card-body">
        <div class="row card-title d-flex justify-content-between">
          <div class="col-md-6 px-0">
            <h4 class="text-primary">Presupuestos</h4>
          </div>
          <div class="col-md-6 px-0 text-right">
            <div class="btn-group rounded w-sm-100">
              <button
                type="button"
                class="btn btn-sm btn-primary"
                (click)="openConfirm(add)"
              >
                <i class="fa fa-plus"></i> Agregar
              </button>
            </div>
          </div>
        </div>
        <div class="rounded-top table-responsive">
          <table class="table table-bordered table-striped table-sm">
            <thead class="bg-light">
              <tr class="text-center text-uppercase">
                <th class="col-md-3">Descripción</th>
                <th class="col-md-3">Fecha</th>
                <th class="col-md-3">Valor</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let pres of negocio?.business_budget"
                class="text-center"
              >
                <th class="align-middle" scope="row">
                  {{ pres?.budget.observation }}
                </th>
                <td class="align-middle">
                  {{ pres?.budget.created_at | date }}
                </td>
                <td class="align-middle">
                  $ {{ pres?.budget.total_cop | number }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="row card-title d-flex justify-content-between">
          <div class="col-md-6 px-0">
            <h4 class="text-primary">Cotizaciones</h4>
          </div>
          <div class="col-md-6 px-0 text-right">
            <div class="btn-group rounded w-sm-100">
              <button
                class="text-center btn btn-primary btn-sm"
                role="button"
                (click)="addCotizacion(); openConfirm(addCotizaciones)"
              >
                <i class="fa fa-plus"></i> Agregar
              </button>
            </div>
          </div>
        </div>
        <div class="rounded-top table-responsive">
          <table class="table table-bordered table-striped table-sm">
            <thead class="bg-light">
              <tr class="text-center text-uppercase">
                <th class="col-md-8">Descripción</th>
                <th class="col-md-2">Fecha</th>
                <th class="col-md-2">Valor</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let coti of cotizaciones">
                <td scope="row">{{ coti.descripcion }}</td>
                <td>{{ coti.fecha | date }}</td>
                <td>$ {{ coti.valor | number }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <span class="badge badge-pill badge-primary">{{
              negocio?.code
            }}</span>
            <h5>
              {{
                negocio?.third_party.first_name
                  ? negocio?.third_party.first_name +
                    " " +
                    negocio?.third_party.first_surname
                  : negocio?.third_party.social_reason
              }}
            </h5>
            <small>
              {{ negocio?.third_party_person.name | uppercase }}
            </small>
            <br />
            <small>
              {{ negocio?.date | date }}
            </small>
            <h6>{{ negocio?.country.name }}</h6>
          </div>
          <img
            [src]="negocio?.third_party.image | image"
            id="imageOutput"
            onerror="this.src='../../../../assets/images/noprofile.png'"
            class="d-block img-thumbnail rounded-circle img-fluid"
          />
        </div>
        <p>{{ negocio?.description }}</p>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <ul
          ngbNav
          #nav="ngbNav"
          [(activeId)]="active"
          class="nav nav-pills nav-justified border border-primary rounded"
        >
          <li [ngbNavItem]="2">
            <a ngbNavLink>Tareas</a>
            <ng-template ngbNavContent>
              <app-tareas-negocio
                [tareas]="tareas"
                [business_budget_id]="business_budget_id"
                (updateListTask)="updateListTask($event)"
              >
              </app-tareas-negocio>
            </ng-template>
          </li>
          <li [ngbNavItem]="1">
            <a ngbNavLink>History</a>
            <ng-template ngbNavContent>
              <app-historial-negocio></app-historial-negocio>
            </ng-template>
          </li>
        </ul>
        <div [ngbNavOutlet]="nav" class="mt-2"></div>
      </div>
    </div>
  </div>
</div>

<ng-template #add let-modal>
  <div class="modal-header">
    <h4 class="text-primary modal-title">
      Seleccionar presupuestos disponibles
    </h4>
    <button
      type="button"
      class="close"
      data-dismiss="modal"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="rounded-top table-responsive">
      <table class="table table-bordered table-striped table-sm">
        <thead class="bg-light">
          <tr class="text-center text-uppercase">
            <th>Item</th>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Destino</th>
            <th>Linea</th>
            <th>Quien elabora</th>
            <th>Total COP</th>
            <th>Total USD</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let item of presupuestos"
            class="text-center"
            [ngClass]="{
              'text-danger font-weight-bold': item.state == 'Inactivo'
            }"
          >
            <td class="align-middle">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  (change)="guardarPresupuesto(item.id, item.total_cop)"
                  [id]="item.id"
                />
                <label class="form-check-label" [for]="item.id">
                  PRES {{ item.id }}
                </label>
              </div>
            </td>
            <td class="align-middle">
              {{ item.created_at | date: "longDate" }}
            </td>
            <td class="align-middle">{{ item.customer.name }}</td>
            <td class="align-middle">{{ item.destiny.name }}</td>
            <td class="align-middle">{{ item.line }}</td>
            <td class="align-middle">
              {{ item.user.person.first_name }}
              {{ item.user.person.first_surname }}
            </td>
            <td class="align-middle">
              ${{ item.total_cop | currency: "":"" }}
            </td>
            <td class="align-middle">
              ${{ item.total_usd | currency: "":"" }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- <ng-select
      [items]="dataModal"
      bindLabel="descripcion "
      [multiple]="true"
      [closeOnSelect]="false"
      [selectableGroup]="true"
      [selectableGroupAsModel]="false"
      [(ngModel)]="seleccionadas"
    >
    </ng-select> -->
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-danger"
      (click)="modal.dismiss('Cross click')"
    >
      Cancelar
    </button>

    <button type="submit " class="btn btn-primary" (click)="saveBudget()">
      Guardar
    </button>
  </div>
</ng-template>

<ng-template #addCotizaciones let-modal>
  <div class="modal-header">
    <h4 class="text-primary modal-title">
      Seleccionar cotizaciones disponibles
    </h4>
    <button
      type="button"
      class="close"
      data-dismiss="modal"
      aria-label="Close"
      (click)="_modal.close()"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
    <table class="mt-2 table table-borderless table-striped">
      <thead>
        <tr>
          <th>Item</th>
          <th>Fecha</th>
          <th>Cliente</th>
          <th>Destino</th>
          <th>Linea</th>
          <th>Quien elabora</th>
          <th>Total COP</th>
          <th>Total USD</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let item of cotizaciones"
          [ngClass]="{
            'text-danger font-weight-bold': item.state == 'Inactivo'
          }"
        >
          <td>
            <input
              type="checkbox"
              [selected]="cotizacionesSeleccionadas.includes(item.id)"
              [change]="guardarCotizacion(item.id)"
            />
            <label [for]="item.id" class="ml-1"> PRES {{ item.id }} </label>
          </td>
          <!-- <td>{{ item.created_at | date: "longDate" }}</td>
          <td>{{ item.customer }}</td>
          <td>{{ item.destiny }}</td>
          <td>{{ item.line }}</td>
          <td>
            {{ item.user.person.first_name }}
            {{ item.user.person.first_surname }}
          </td>
          <td>${{ item.total_cop | currency: "":"" }}</td>
          <td>${{ item.total_usd | currency: "":"" }}</td> -->
        </tr>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="_modal.close()">
      Cancelar
    </button>
    <button
      type="button"
      (click)="modalCotizaciones.hide(); closeModalCotizaciones()"
      class="btn btn-primary"
    >
      Guardar
    </button>
  </div>
</ng-template>

