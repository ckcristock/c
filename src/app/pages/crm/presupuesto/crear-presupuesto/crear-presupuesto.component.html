<div *ngIf="!loading">
  <div class="card">
    <div class="card-body">
      <div class="card-title">
        <h4 class="text-primary">Nuevo Presupuesto</h4>
      </div>
      <hr class="line" />
      <form [formGroup]="forma" (submit)="save()">
        <div class="row">
          <div class="col-6">
            <div class="form-group row">
              <label for="staticEmail" class="col-sm-2 col-form-label"
                >Cliente</label
              >
              <!-- <div class="col-sm-10">
                <ng-select [items]="custumer$ | async" bindLabel="text" bindValue="value" 
                [loading]="custumerLoading" [typeahead]="custumerInput$" formControlName="customer_id"
                typeToSearchText="Por favor escriba para buscar"
                ></ng-select>
              </div> -->
              <div class="col-sm-10">
                <ng-select
                  class=""
                  bindLabel="text"
                  [items]="clients"
                  bindValue="value"
                  loadingText="loading "
                  ngDefaultControl
                  formControlName="customer_id"
                ></ng-select>
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="form-group row">
              <label for="staticEmail" class="col-sm-2 col-form-label"
                >Destino</label
              >
              <div class="col-sm-10">
                <ng-select
                  [items]="cities"
                  bindLabel="text"
                  bindValue="value"
                  formControlName="destinity_id"
                ></ng-select>
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="form-group row">
              <label for="staticEmail" class="col-sm-2 col-form-label"
                >Linea</label
              >
              <div class="col-sm-10">
                <input
                  formControlName="line"
                  type="text"
                  class="form-control"
                />
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="form-group row">
              <label for="staticEmail" class="col-sm-2 col-form-label"
                >TRM</label
              >
              <div class="col-sm-10">
                <input
                  formControlName="trm"
                  type="number"
                  class="form-control"
                />
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="form-group row">
              <label for="staticEmail" class="col-sm-2 col-form-label"
                >Proyecto</label
              >
              <div class="col-sm-10">
                <input
                  formControlName="project"
                  type="text"
                  class="form-control"
                />
              </div>
            </div>
          </div>
        </div>
        <!-- END HEADER -->

        <!-- Configuracion presupuestal -->
        <div class="row mt-2">
          <div class="col-12">
            <table class="table table-striped table-sm">
              <thead>
                <tr>
                  <th class="text-center" colspan="3">
                    <h5>% De configuración presupuestal</h5>
                  </th>
                </tr>
              </thead>
              <tbody class="bg-light">
                <ng-container formArrayName="indirect_costs">
                  <ng-container
                    *ngFor="let item of indirecCostList.controls; let i = index"
                  >
                    <tr [formGroupName]="i">
                      <td>{{ item.controls.name.value }}</td>
                      <td>
                        <input
                          type="number"
                          class="form-control form-control-sm"
                          formControlName="percentage"
                        />
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
              </tbody>
            </table>
          </div>
        </div>
        <!--  END  Configuracion presupuestal -->

        <div class="row mb-2">
          <div class="col-12">
            <div class="form-group">
              <label for="staticEmail">Observaciones</label>
              <textarea
                formControlName="observation"
                class="form-control"
                cols="100%"
                rows="3"
              ></textarea>
            </div>
          </div>
        </div>
        <!-- ITEMS -->

        <app-items
          [forma]="forma"
          [dataEdit]="dataEdit"
          [indirectCosts]="indirectCosts"
          [calculationBase]="calculationBase"
        >
        </app-items>

        <div *ngIf="hasItems" class="col-12 card card-body">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th colspan="2" class="text-center">TOTAL PRESUPUESTO</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>TOTAL COP $</td>
                <td class="text-right" style="width: 90px">
                  {{ total_cop | currency: "":"" }}
                </td>
              </tr>
              <tr>
                <td>TOTAL USD $</td>
                <td class="text-right" style="width: 90px">
                  {{ total_usd | currency: "":"" }}
                </td>
              </tr>
              <tr>
                <td>V/U VENTA PRORRATEADO COP $</td>
                <td class="text-right" style="width: 90px">
                  {{ unit_value_prorrateado_cop | currency: "":"" }}
                </td>
              </tr>
              <tr>
                <td>V/U VENTA PRORRATEADO USD $</td>
                <td class="text-right" style="width: 90px">
                  {{ unit_value_prorrateado_usd | currency: "":"" }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- END ITEMS -->
        <!--  -->
        <div class="row">
          <div class="col-12">
            <button class="btn btn-block btn-sm btn-primary" type="submit">
              Guardar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<ng-template #notData>
  <div class="alert alert-warning" role="alert">
    ¡Aquí no hay datos!
  </div>
</ng-template>
