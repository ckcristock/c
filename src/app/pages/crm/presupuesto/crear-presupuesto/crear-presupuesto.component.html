<div *ngIf="!loading">
  <div class="card">
    <div class="card-body">
      <div class="card-title">
        <h4 class="text-primary">Nuevo presupuesto</h4>
      </div>
      <hr class="line" />
      <form [formGroup]="forma" (submit)="save()">
        <div class="row">
          <div class="col-md-3 mb-4">
            <ng-select
              bindLabel="text"
              [items]="clients"
              placeholder="Cliente"
              appearance="outline"
              bindValue="value"
              loadingText="loading "
              ngDefaultControl
              formControlName="customer_id"
              [appendTo]="'body'"
            ></ng-select>
          </div>
          <div class="col-md-3 mb-4">
            <ng-select
              [items]="cities"
              placeholder="Destino"
              appearance="outline"
              bindLabel="text"
              bindValue="value"
              [appendTo]="'body'"
              formControlName="destinity_id"
            ></ng-select>
          </div>
          <mat-form-field class="col-md-2" appearance="outline">
            <mat-label>Línea</mat-label>
            <input
              matInput
              type="text"
              placeholder="Ingresa la línea"
              formControlName="line"
              autocomplete="off"
            />
          </mat-form-field>
          <mat-form-field class="col-md-2" appearance="outline">
            <mat-label>TRM</mat-label>
            <input
              matInput
              type="number"
              placeholder="Ingresa TRM"
              formControlName="trm"
              autocomplete="off"
            />
          </mat-form-field>
          <mat-form-field class="col-md-2" appearance="outline">
            <mat-label>Proyecto</mat-label>
            <input
              matInput
              type="text"
              placeholder="Ingresa proyecto"
              formControlName="project"
              autocomplete="off"
            />
          </mat-form-field>
        </div>
        <!-- END HEADER -->

        <!-- Configuracion presupuestal -->
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th class="text-center" colspan="3">
                <h5>Porcentaje de configuración presupuestal</h5>
              </th>
            </tr>
          </thead>
          <tbody class="bg-light">
            <ng-container formArrayName="indirect_costs">
              <ng-container
                *ngFor="let item of indirecCostList.controls; let i = index"
              >
                <tr [formGroupName]="i">
                  <td>{{ item.controls.name.value }}</td>
                  <td>
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      formControlName="percentage"
                    />
                  </td>
                </tr>
              </ng-container>
            </ng-container>
          </tbody>
        </table>
        <!--  END  Configuracion presupuestal -->
        <mat-form-field
          class="col-md-12 px-0 mat-form-field-no-padding textarea"
          appearance="outline"
        >
          <mat-label>Observaciones</mat-label>
          <textarea
            matInput
            placeholder="Ingresa las observaciones"
            rows="5"
            formControlName="observation"
            [cdkTextareaAutosize]="true"
          ></textarea>
        </mat-form-field>
        <!-- ITEMS -->
        <hr>
        <app-items
          [forma]="forma"
          [dataEdit]="dataEdit"
          [indirectCosts]="indirectCosts"
          [calculationBase]="calculationBase"
        >
        </app-items>

        <div *ngIf="hasItems">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th colspan="2" class="text-center">
                  <h5>PRESUPUESTO TOTAL</h5>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>TOTAL COP $</td>
                <td class="text-right" style="width: 90px">
                  {{ total_cop | currency: "":"" }}
                </td>
              </tr>
              <tr>
                <td>TOTAL USD $</td>
                <td class="text-right" style="width: 90px">
                  {{ total_usd | currency: "":"" }}
                </td>
              </tr>
              <tr>
                <td>V/U VENTA PRORRATEADO COP $</td>
                <td class="text-right" style="width: 90px">
                  {{ unit_value_prorrateado_cop | currency: "":"" }}
                </td>
              </tr>
              <tr>
                <td>V/U VENTA PRORRATEADO USD $</td>
                <td class="text-right" style="width: 90px">
                  {{ unit_value_prorrateado_usd | currency: "":"" }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- END ITEMS -->
        <!--  -->
        <div class="row">
          <div class="col-12">
            <button class="btn btn-block btn-primary" type="submit">
              Guardar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<ng-template #notData>
  <div class="alert alert-warning" role="alert">¡Aquí no hay datos!</div>
</ng-template>

<!-- <div class="col-sm-10">
  <ng-select
    [items]="custumer$ | async"
    bindLabel="text"
    bindValue="value"
    [loading]="custumerLoading"
    [typeahead]="custumerInput$"
    formControlName="customer_id"
    typeToSearchText="Por favor escriba para buscar"
  ></ng-select>
</div>
 -->
