<div class="page-body">
    <div class="row">
        <div class="col-md-6">
            <div class=" project-task">
                <div class="card widget-statstic-card borderless-card">
                    <div class="card-header">
                        <div class="card-header-left">
                            <h5>Fase I</h5>
                            <p class="p-t-10 m-b-0 text-muted">Remisiones</p>
                            <i class="fa fa-barcode st-icon bg-warning"></i>
                        </div>
                        <div class="card-header-right">
                            <div style="width:120px;margin-right:80px;float:right;">
                                <input class="form-control" [(ngModel)]="filtro_Destino1" (change)="filtrosFase1()" placeholder="Destino" />
                            </div>
                            <div style="width:120px;margin-right:10px;float:right;">
                                <input class="form-control" [(ngModel)]="filtro_Origen1" (change)="filtrosFase1()" placeholder="Filtro Origen" />
                            </div>
                            <div style="width:120px;margin-right:10px;float:right;">
                                <input class="form-control" [(ngModel)]="filtro_Codigo1" (change)="filtrosFase1()" placeholder="Filtro Código" />
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-b-10 " style="overflow:auto; height: 400px;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="text-center" *ngIf="FaseI.length==0&&!ValidaFase1">
                                    <i class="fa fa-spinner fa-spin fa-5x"></i>
                                    <h4>Cargando Remisiones por Alistamiento Fase 1</h4>
                                </div>
                                <div class="text-center" *ngIf="FaseI.length==0&&ValidaFase1">
                                    <i class="fa fa-smile fa-5x"></i>
                                    <h4>No existen Remisiones en espera de Fase 1</h4>
                                </div>
                                <table class="table table-hover ">
                                    <tr *ngFor="let item of FaseI; let i = index" id="fila{{i}}">
                                        <td style="width:50px;">
                                            <div class="feed-user-img">
                                                <img  [src]="item.Imagen | image :'users'" style="width: 50px;" class="rounded-circle avatar-sm" alt="">
                                            </div>
                                        </td>
                                        <td style="padding:8px !important;">
                                            <h6>{{item.Tipo}} {{item.Codigo}}</h6>
                                            <p class="text-muted"><strong>Origen: </strong> {{item.Nombre_Origen}}</p>
                                            <p class="destino"><strong>Destino: </strong> {{item.Nombre_Destino}}</p>
                                        </td>
                                        <td style="width:30px;text-align:center;">
                                            <i *ngIf="item.Tipo_Bodega=='MEDICAMENTOS'" class="fa fa-medkit fa-2x" style="color:green"></i>
                                            <i *ngIf="item.Tipo_Bodega=='MATERIALES'" class="fa fa-th-large fa-2x" style="color:rgb(87, 87, 67)"></i>
                                            <i *ngIf="item.Tipo_Bodega=='REFRIGERADOS'" class="fas fa-snowflake fa-2x" style="color:#2569e8"></i>
                                        </td>
                                        <td style="width:90px;">
                                            <p class="text-muted "> Prioridad {{item.Prioridad}} </p>
                                        </td>
                                        <td style="width:75px;">
                                            <button class="btn btn-warning  btn-sm " (click)="Bandera_Fase1(item.Id_Remision,item.Tipo,item.Id_Contrato)">Iniciar
                        Fase I</button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class=" project-task">
                <div class="card widget-statstic-card borderless-card">
                    <div class="card-header">
                        <div class="card-header-left">
                            <h5>Fase II</h5>
                            <p class="p-t-10 m-b-0 text-muted">Remisiones </p>
                            <i class="ti ti-package st-icon bg-success"></i>
                        </div>
                        <div class="card-header-right">
                            <div style="width:120px;margin-right:80px;float:right;">
                                <input class="form-control" [(ngModel)]="filtro_Destino2" (change)="filtrosFase2()" placeholder="Destino" />
                            </div>
                            <div style="width:120px;margin-right:10px;float:right;">
                                <input class="form-control" [(ngModel)]="filtro_Origen2" (change)="filtrosFase2()" placeholder="Filtro Origen" />
                            </div>
                            <div style="width:120px;margin-right:10px;float:right;">
                                <input class="form-control" [(ngModel)]="filtro_Codigo2" (change)="filtrosFase2()" placeholder="Filtro Código" />
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-b-10" style="overflow:auto; height: 400px;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="text-center" *ngIf="FaseII.length==0&&!ValidaFase2">
                                    <i class="fa fa-spinner fa-spin fa-5x"></i>
                                    <h4>Cargando Remisiones por Alistamiento Fase 2</h4>
                                </div>
                                <div class="text-center" *ngIf="FaseII.length==0&&ValidaFase2">
                                    <i class="fa fa-smile fa-5x"></i>
                                    <h4>No existen Remisiones en espera de Fase 2</h4>
                                </div>
                                <table class="table table-hover">
                                    <tr *ngFor="let item of FaseII; let i = index" id="fila{{i}}">
                                        <td style="width:50px;">
                                            <div class="feed-user-img">

                                                <img  [src]="item.Imagen | image :'users'" style="width: 50px;" class="rounded-circle avatar-sm" alt="">
                                            </div>
                                        </td>
                                        <td style="padding:8px !important;">
                                            <h6>{{item.Tipo}} {{item.Codigo}}</h6>
                                            <p class="text-muted"><strong>Origen: </strong> {{item.Nombre_Origen}}</p>
                                            <p class="text-muted"><strong>Destino: </strong> {{item.Nombre_Destino}}</p>
                                        </td>

                                        <td style="width:30px;text-align:center;">
                                            <i *ngIf="item.Tipo_Bodega=='MEDICAMENTOS'" class="fa fa-medkit fa-2x" style="color:green"></i>
                                            <i *ngIf="item.Tipo_Bodega=='MATERIALES'" class="fa fa-th-large fa-2x" style="color:rgb(87, 87, 67)"></i>
                                            <i *ngIf="item.Tipo_Bodega=='REFRIGERADOS'" class="fas fa-snowflake fa-2x" style="color:#2569e8"></i>
                                        </td>
                                        <td style="width:90px;">
                                            <p class="text-muted "> Prioridad {{item.Prioridad}} </p>
                                        </td>
                                        <td style="width:75px;">
                                            <button class="btn btn-success btn-sm " (click)="Bandera_Fase2(item.Id_Remision,item.Tipo,item.Id_Contrato)">Iniciar
                        Fase II</button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">

            <div class="card">
                <div class="card-header">
                    <h5>Alistamiento</h5>
                    <span>Todas las Remisiones que ya fueron alistadas.</span>

                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-12">
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr style="text-align: center;">
                                        <th style="width: 100px;">Fecha</th>
                                        <th style="width: 80px;">Codigo</th>
                                        <th style="width: 80px;">Tipo</th>
                                        <th>Origen</th>
                                        <th>Destino</th>
                                        <th style="width:150px;">Guía</th>
                                        <th style="width: 50px;">Items</th>
                                        <th style="width: 80px;">Estado</th>
                                        <th style="width: 80px;">Acciones</th>
                                    </tr>
                                    <tr>
                                        <th class="tabla-filtro">
                                            <my-date-range-picker name="mydaterange" [options]="myDateRangePickerOptions" [(ngModel)]="filtro_fecha" (dateRangeChanged)="dateRangeChanged($event)" placeholder="Filtro Fechas"></my-date-range-picker>
                                        </th>
                                        <th class="tabla-filtro"><input class="form-control input-sm" (blur)="filtros()" [(ngModel)]="filtro_cod" placeholder="Filtro Código" /></th>
                                        <th class="tabla-filtro">
                                            <select [(ngModel)]="filtro_tipo" (change)="filtros()" class="form-control input-sm">
                              <option value="">Todos</option>
                              <option value="Interna">Interna</option>
                              <option value="Cliente">Cliente</option>
                              <option value="Devolucion">Devolución</option>
                            </select>
                                        </th>
                                        <th class="tabla-filtro"><input class="form-control input-sm" (blur)="filtros()" [(ngModel)]="filtro_origen" placeholder="Filtro Origen" /></th>
                                        <th class="tabla-filtro"><input class="form-control input-sm" (blur)="filtros()" [(ngModel)]="filtro_destino" placeholder="Filtro Destino" /></th>
                                        <th class="tabla-filtro"></th>
                                        <th class="tabla-filtro"></th>
                                        <th class="tabla-filtro">
                                            <select [(ngModel)]="filtro_est" (change)="filtros()" class="form-control input-sm">
                                <option value="">Todos</option>
                                <option value="Pendiente">Pendiente</option>
                                <option value="Activa">Activa - Dev</option>
                                <option value="Alistada">Alistada</option>
                                <option value="Enviada">Enviada</option>
                                <option value="Recibida">Recibida</option>
                                <option value="No conforme">No conforme</option>
                                <option value="Anulada">Anulada</option>
                                <option value="Facturada">Facturada</option>
                            </select>
                                        </th>
                                        <th class="tabla-filtro"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let alistamiento of Alistamientos; let i = index">
                                        <td class="text-center">{{alistamiento.Fecha | date:'dd/MM/yyyy'}}</td>
                                        <td class="text-center">{{alistamiento.Codigo}}</td>
                                        <td>
                                            <div class="text-center">
                                                <span class="label {{alistamiento.Tipo=='Cliente' ? 'label-success' : 'label-warning'}} {{alistamiento.Tipo=='Devolucion' ? 'label-danger' : ''}}">{{alistamiento.Tipo}}
                            </span>
                                            </div>
                                        </td>
                                        <td class="text-center">{{alistamiento.NombreOrigen}}
                                            <i *ngIf="alistamiento.Tipo_Bodega=='MEDICAMENTOS'" class="fa fa-medkit"></i>
                                            <i *ngIf="alistamiento.Tipo_Bodega=='MATERIALES'" class="fa fa-archive"></i>
                                            <i *ngIf="alistamiento.Tipo_Bodega=='REFRIGERADOS'" class="fa fa-asterisk"></i>
                                        </td>
                                        <td>{{alistamiento.NombreDestino}}</td>
                                        <td>
                                            <div *ngIf="alistamiento.Guia!=''">
                                                <i class="fa fa-barcode"></i> {{alistamiento.Guia}}<br>
                                                <i class="fa fa-truck"></i> {{alistamiento.Empresa_Envio}}
                                            </div>
                                        </td>
                                        <td class="text-center">{{alistamiento.Items}}</td>
                                        <td>
                                            <div class="text-center">
                                                <span *ngIf="alistamiento.Estado!='Facturada'" class="label {{alistamiento.Estado=='Anulada' ? '' : ''}} {{alistamiento.Estado=='Alistada' ? 'label-inverse' : ''}} {{alistamiento.Estado=='Enviada' ? 'label-info' : ''}} {{alistamiento.Estado=='Pendiente'&&alistamiento.Fase==1 ? 'label-danger' : ''}} {{alistamiento.Estado=='Pendiente'&&alistamiento.Fase==2 ? 'label-danger' : ''}}
                              {{alistamiento.Estado=='Recibida' ? 'label-success' : ''}}      {{alistamiento.Estado=='Anulada' ? 'label-danger' : ''}}  {{alistamiento.Estado=='Activa' ? 'label-warning' : ''}}">{{alistamiento.Estado}} </span>

                                                <a *ngIf="alistamiento.Estado=='Facturada'" class="label label-success" [routerLink]="['/facturasventasver', alistamiento.Id_Factura]">Facturada</a>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-center">
                                                <div ngbDropdown class="dropdown-primary">
                                                    <button ngbDropdownToggle class="btn btn-secondary btn-mini waves-effect waves-light " type="button">Acciones</button>
                                                    <div ngbDropdownMenu>
                                                        <a class="dropdown-item waves-light waves-effect caja-botones" *ngIf="alistamiento.Tipo != 'Devolucion'" href="" [routerLink]="['/inventario/remisiones/remision',alistamiento.Id_Remision]">
                                                            <i class="fa fa-eye"></i>Ver!</a>
                                                        <a class="dropdown-item waves-light waves-effect caja-botones" *ngIf="alistamiento.Tipo == 'Devolucion'" href="" [routerLink]="['/verdetalledevolucion',alistamiento.Id_Remision]">
                                                            <i class="fa fa-eye"></i>Ver.</a>
                                                        <a class="dropdown-item waves-light waves-effect caja-botones" href="{{envi.ruta}}/php/archivos/descarga_pdf.php?tipo=Remision&id={{alistamiento.Id_Remision}}" target="_blank">
                                                            <i class="fa fa-print"></i> Imprimir Archivo</a>
                                                        <a class="dropdown-item waves-light waves-effect caja-botones" href="{{envi.ruta}}/php/archivos/descarga_zebra.php?id={{alistamiento.Id_Remision}}" target="_blank">
                                                            <i class="fa fa-ticket-alt"></i> Imprimir Etiqueta</a>
                                                        <a *ngIf="alistamiento.Estado_Alistamiento==2 && alistamiento.Estado=='Alistada'" class="dropdown-item waves-light waves-effect caja-botones" (click)="CapturarId(alistamiento.Id_Remision,alistamiento.Tipo)"><i class="fa fa-plus"></i>Agregar Guía</a>
                                                        <a *ngIf="alistamiento.Guia!='' && (alistamiento.Estado!='Recibida' && alistamiento.Estado!='Anulada')" class="dropdown-item waves-light waves-effect caja-botones" (click)="EditarGuia(alistamiento.Id_Remision,i,alistamiento.Tipo)"><i class="fa fa-truck"></i>Editar Guía</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <ngb-pagination class="pull-right" [collectionSize]="TotalItems" [(page)]="page" [maxSize]="maxSize" size="sm" (pageChange)="paginacion()" [pageSize]="20" [boundaryLinks]="true"></ngb-pagination>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>

<app-modal-basic #modalGuiaRemisionEditar [dialogClass]="'modal-lg'">
    <div class="app-modal-header">
        <h4 class="modal-title">Datos de Envío de la Remisión</h4>
        <button type="button" class="close basic-close" (click)="modalGuiaRemisionEditar.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
    </div>
    <div class="app-modal-body">
        <form #FormGuiaRemision="ngForm">
            <div class="row">
                <div class="col-md-5">
                    <div class="form-group">
                        <label>Número de Guía</label>
                        <input name="Numero_Guia" type="text" placeholder="Número de Guía" class="form-control form-control-sm" [(ngModel)]="Editar.Numero_Guia" required>

                    </div>
                </div>
                <div class="col-md-7">
                    <div class="form-group">
                        <label>Empresa de Envio</label>
                        <input name="Empresa_Envio" type="text" placeholder="Empresa de Envio" class="form-control form-control-sm " [(ngModel)]="Editar.Empresa_Envio" required>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="app-modal-footer">
        <div class="text-right">
            <button type="button" class="btn btn-primary btn-sm btn-block" [disabled]="!FormGuiaRemision.valid" (click)="showAlert($event)">Guardar Información</button>
        </div>
    </div>

</app-modal-basic>
<swal #confirmacionSwal title="" text="" icon=""></swal>
<swal #confirmacionSalir title="" html="" icon="" (confirm)="ListarAlistamientos()"></swal>
<swal #confirmacionGuardar (confirm)="save()" [swalOptions]="alertOption"></swal>