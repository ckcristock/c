<ng-template #placeholder>
  <app-placeholder-form></app-placeholder-form>
</ng-template>
<ng-container *ngIf="!loading && form; else placeholder">
  <div class="card">
    <div class="card-body">
      <app-cabecera [datosCabecera]="datosCabecera"></app-cabecera>
      <hr class="line" />
      <ng-container [formGroup]="form">
        <div class="row">
          <mat-form-field class="col-md-6" appearance="outline">
            <mat-label>Nombre</mat-label>
            <input
              matInput
              type="text"
              formControlName="name"
              placeholder="Ingresa el nombre"
              autocomplete="off"
              required
            />
            <mat-error>Campo obligatorio</mat-error>
          </mat-form-field>
          <mat-form-field class="col-md-3" appearance="outline">
            <mat-label>Órden de pedido</mat-label>
            <input
              matInput
              type="text"
              formControlName="purchase_order"
              autocomplete="off"
              required
            />
            <mat-error>Campo obligatorio</mat-error>
          </mat-form-field>
          <mat-form-field class="col-md-3" appearance="outline">
            <mat-label>Fecha de entrega</mat-label>
            <input
              formControlName="expected_delivery_date"
              matInput
              [matDatepicker]="dp_delivery"
              [min]="today"
              [required]="true"
            />
            <mat-hint
              >{{
                (form.get("expected_delivery_date").value
                  | date : "fullDate") || "DD/MM/YYYY"
              }}
            </mat-hint>
            <mat-error>Campo obligatorio</mat-error>
            <mat-datepicker-toggle
              matSuffix
              [for]="dp_delivery"
            ></mat-datepicker-toggle>
            <mat-datepicker #dp_delivery></mat-datepicker>
          </mat-form-field>
          <mat-form-field class="col-md-3" appearance="outline">
            <mat-label>Tipo</mat-label>
            <mat-select formControlName="type" required>
              <mat-option value="V">V</mat-option>
              <mat-option value="Y">I</mat-option>
              <mat-option value="G">G</mat-option>
            </mat-select>
            <mat-error>Campo obligatorio</mat-error>
          </mat-form-field>
          <mat-form-field class="col-md-3" appearance="outline">
            <mat-label>Clase</mat-label>
            <mat-select formControlName="class" required>
              <mat-option value="Interna">Interna</mat-option>
              <mat-option value="Proyecto">Proyecto</mat-option>
              <mat-option value="Repuesto">Repuesto</mat-option>
              <mat-option value="Servicio">Servicio</mat-option>
            </mat-select>
            <mat-error>Campo obligatorio</mat-error>
          </mat-form-field>
          <div class="col-md-6 mat-form-field-wrapper">
            <ng-select
              formControlName="municipality_id"
              [items]="cities"
              bindLabel="text"
              [class.is-invalid]="form.get('municipality_id')?.invalid"
              appearance="outline"
              [appendTo]="'body'"
              [clearable]="false"
              placeholder="Destino *"
              bindValue="value"
              loadingText="loading"
            >
            </ng-select>
          </div>
          <div
            class="col-md-6 mat-form-field-wrapper"
            *ngIf="form.get('third_party_id').enabled"
          >
            <ng-select
              formControlName="third_party_id"
              [items]="thirds"
              [clearable]="false"
              bindLabel="text"
              appearance="outline"
              [class.is-invalid]="form.get('third_party_id')?.invalid"
              [appendTo]="'body'"
              placeholder="Cliente *"
              bindValue="value"
              loadingText="loading"
              ngDefaultControl
            >
            </ng-select>
          </div>
          <div
            class="col-md-6 mat-form-field-wrapper"
            *ngIf="form.get('third_party_person_id').enabled"
          >
            <ng-select
              formControlName="third_party_person_id"
              [items]="third_people"
              [clearable]="false"
              bindLabel="text"
              appearance="outline"
              [class.is-invalid]="form.get('third_party_person_id')?.invalid"
              [appendTo]="'body'"
              placeholder="Contacto *"
              bindValue="value"
              loadingText="loading"
              ngDefaultControl
            >
            </ng-select>
          </div>
          <mat-form-field
            class="col-12 mat-form-field-no-padding textarea"
            appearance="outline"
          >
            <mat-label>Observaciones</mat-label>
            <textarea
              matInput
              placeholder="Ingresa las observaciones"
              rows="5"
              formControlName="observations"
              [cdkTextareaAutosize]="true"
            ></textarea>
          </mat-form-field>
          <div class="col-12">
            <div class="btn-group btn-block mb-2" role="group">
              <button
                class="btn btn-info"
                type="button"
                (click)="modalPresupuesto.openModal()"
              >
                <i class="fas fa-file-invoice-dollar"></i> Presupuesto
              </button>
              <button
                class="btn btn-info"
                type="button"
                (click)="modalCotizacion.openModal()"
              >
                <i class="fas fa-file-alt"></i> Cotización
              </button>
              <button
                class="btn btn-info"
                type="button"
                (click)="modalNegocio.openModal()"
              >
                <i class="fas fa-building"></i> Negocio
              </button>
              <button
                class="btn btn-info"
                type="button"
                (click)="modalPieza.openConfirm()"
              >
                <i class="fas fa-cogs"></i> Pieza
              </button>
              <button
                class="btn btn-info"
                type="button"
                (click)="modalConjunto.openConfirm()"
              >
                <i class="fas fa-puzzle-piece"></i> Conjunto
              </button>
              <button
                class="btn btn-info"
                type="button"
                (click)="modalServicio.openConfirm()"
              >
                <i class="fas fa-tools"></i> Servicio
              </button>
            </div>
          </div>
        </div>
        <div class="mb-4">
          <div>Descripcion</div>
          <ckeditor
            [editor]="_texteditor.Editor"
            (ready)="_texteditor.onReady($event)"
            [config]="_texteditor.configEditor"
            formControlName="description"
          ></ckeditor>
        </div>
        <div class="mb-4">
          <div>Requisitos técnicos, funcionales y desempeño</div>
          <ckeditor
            [editor]="_texteditor.Editor"
            (ready)="_texteditor.onReady($event)"
            [config]="_texteditor.configEditor"
            formControlName="technical_requirements"
          ></ckeditor>
        </div>
        <div class="mb-4">
          <div>Requisitos legales o reglamentos aplicables</div>
          <ckeditor
            [editor]="_texteditor.Editor"
            (ready)="_texteditor.onReady($event)"
            [config]="_texteditor.configEditor"
            formControlName="legal_requirements"
          ></ckeditor>
        </div>
      </ng-container>
      <button type="button" class="btn btn-primary btn-block" (click)="save()">
        Guardar y enviar
      </button>
    </div>
  </div>
</ng-container>

<ng-template #rt_quotation let-r="result" let-t="term">
  <div>{{ r.name }}</div>
</ng-template>
<ng-template #notData>
  <app-not-data [loading]="loading"></app-not-data>
</ng-template>

<app-modal-buscar-presupuesto
  #modalPresupuesto
  (update)="newBudget($event)"
  [create]="true"
  [third_party_id]="' '"
></app-modal-buscar-presupuesto>

<app-modal-buscar-cotizacion
  (update)="newQuotation($event)"
  [create]="true"
  #modalCotizacion
  [third_party_id]="' '"
>
</app-modal-buscar-cotizacion>

<app-get-apus
  (sendApus)="newApuPart($event)"
  #modalPieza
  [filter]="filterPart"
></app-get-apus>

<app-get-apus
  (sendApus)="newApuSet($event)"
  #modalConjunto
  [filter]="filterSet"
>
</app-get-apus>

<app-get-apus
  (sendApus)="newApuService($event)"
  #modalServicio
  [filter]="filterService"
>
</app-get-apus>

<app-get-business
  (update)="newBusiness($event)"
  #modalNegocio
></app-get-business>
