<app-crear-novedad
  [open]="openModal"
  (saving)="cargarNovedades()"
></app-crear-novedad>

<div class="row">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-body">
        <div class="row card-title d-flex justify-content-between">
          <div class="col-md-6 px-0">
            <h4 class="text-primary">Novedades</h4>
          </div>
          <div class="col-md-6 px-0 text-right">
            <div class="btn-group rounded w-sm-100">
              <button
                class="btn btn-primary btn-sm"
                (click)="openModal.emit()"
              >
                <i class="fa fa-plus"></i> Agregar
              </button>
              <button
                class="btn btn-info btn-sm"
                (click)="openClose()"
              >
                <i class="fas fa-sliders-h"></i> Filtros
              </button>
            </div>
          </div>
        </div>
        <hr class="line" />
        <mat-accordion multi>
          <mat-expansion-panel class="mat-elevation-z0">
            <form [formGroup]="form" (ngSubmit)="cargarNovedades()">
              <div class="row">
                <div class="col">
                  <ng-select
                    formControlName="personfill"
                    [items]="peopleSelects"
                    bindLabel="text"
                    bindValue="value"
                    loadingText="loading"
                    appearance="outline"
                    [appendTo]="'body'"
                    placeholder="Funcionario"
                    (change)="cargarNovedades()"
                    ngDefaultControl
                  >
                  </ng-select>
                </div>
                <mat-form-field class="col" appearance="outline">
                  <mat-label>Fecha de inicio</mat-label>
                  <input matInput type="date" formControlName="date_start" />
                </mat-form-field>
                <mat-form-field class="col" appearance="outline">
                  <mat-label>Fecha de fin</mat-label>
                  <input matInput type="date" formControlName="date_end" />
                </mat-form-field>
                <div class="col-md-12 text-center mb-2">
                  <button
                    type="submit"
                    class="btn btn-outline-primary btn-sm btn-block"
                  >
                    <i class="fas fa search"></i> Filtrar por fecha
                  </button>
                </div>
              </div>
            </form>
          </mat-expansion-panel>
        </mat-accordion>
        <div class="rounded-top table-responsive">
          <table
            class="table table-bordered table-striped table-sm"
            
            *ngIf="!loading && people.length > 0; else notData"
          >
            <thead class="bg-light">
              <tr class="text-center text-uppercase">
                <th>Foto</th>
                <th>Funcionarios</th>
                <th>Dependencia</th>
                <th class="col-1">
                  <i class="fas fa-angle-down"></i>
                </th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let person of people">
                <tr class="text-center">
                  <td class="align-middle">
                    <img
                      src="{{ person?.image | image }}"
                      onerror="this.src='../../../../assets/images/noprofile.png'"
                      class="img-thumbnail rounded-circle header-profile-user mx-auto d-block"
                    />
                  </td>
                  <td class="align-middle">
                    {{ person.first_name }} {{ person.first_surname }}
                  </td>
                  <td class="align-middle">
                    {{ person.contractultimate.position.dependency.name }}
                  </td>
                  <td class="align-middle">
                    <i
                      class="fas fa-angle-down text-primary"
                      role="button"
                      (click)="person.selected = !person.selected"
                    ></i>
                  </td>
                </tr>
                <ng-container *ngIf="this.person.selected">
                  <tr class="p-0">
                    <td colspan="4">
                      <div class="rounded-top table-responsive">
                        <table class="table table-hover">
                          <thead class="bg-light">
                            <tr class="text-center text-uppercase">
                              <th>Fecha</th>
                              <th>Novedad</th>
                              <th>Descripción</th>
                              <th>Inicio</th>
                              <th>Fin</th>
                              <th class="col-1">ACC.</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr
                              *ngFor="let fact of person.payroll_factors"
                              class="text-center"
                            >
                              <td class="align-middle">
                                {{ fact.created_at | date }}
                              </td>
                              <td class="align-middle">
                                {{ fact.disability_leave.concept }}
                              </td>
                              <td class="align-middle">
                                {{ fact.observation }}
                              </td>
                              <td class="align-middle">
                                {{ fact.date_start | date }}
                              </td>
                              <td class="align-middle">
                                {{ fact.date_end | date }}
                              </td>
                              <td class="align-middle">
                                <div
                                  ngbDropdown
                                  container="body"
                                  class="dropdown-primary"
                                >
                                  <button
                                    ngbDropdownToggle
                                    class="btn btn-primary btn-sm waves-light"
                                    type="button"
                                  >
                                    <i class="fas fa-sort-down"></i>
                                  </button>
                                  <div ngbDropdownMenu>
                                    <a
                                      class="dropdown-item text-info waves-light caja-botones"
                                      (click)="editarNovedad(fact)"
                                    >
                                      <i class="fas fa-edit"></i> Editar</a
                                    >
                                    <!-- <a class="dropdown-item waves-light  caja-botones" href="" [swal]="{title:'¿Está Seguro?',text : 'Se dispone a eliminar la novedad' , type:'warning', showCancelButton: true, confirmButtonText: 'Si, Eliminar', cancelButtonText:'Dejame verificar'}"
                                                                      (confirm)="EliminarNovedad(novedad.Id_Novedad)">
                                                                      <i class="fa fa-times"></i> Elim.</a> -->
                                  </div>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </td>
                  </tr>
                </ng-container>
              </ng-container>
            </tbody>
          </table>
        </div>
      </div>

      <ng-template #notData>
        <app-not-data [loading]="loading"></app-not-data>
      </ng-template>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="row">
      <div class="col-6">
        <div class="card mb-4">
          <div class="card-body text-center incapacidades">
            <i class="ri-suitcase-3-fill"></i>
            <p class="card-text mb-0">Vacaciones</p>
            <p class="lead text-center">{{ totalVacaciones }}</p>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card mb-4">
          <div class="card-body text-center incapacidades">
            <i class="fas fa-heartbeat"></i>
            <p class="card-text mb-0">Incapacidades</p>
            <p class="lead text-center">{{ totalIncapacidades }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-6">
        <div class="card mb-4">
          <div class="card-body text-center incapacidades">
            <i class="fas fa-baby"></i>
            <p class="card-text mb-0">Licencias</p>
            <p class="lead text-center">{{ totalLicencias }}</p>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card mb-4">
          <div class="card-body text-center incapacidades">
            <i class="ri-calendar-check-line"></i>
            <p class="card-text mb-0">Permisos</p>
            <p class="lead text-center">{{ totalPermisos }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-6">
        <div class="card mb-4">
          <div class="card-body text-center incapacidades">
            <i class="fas fa-door-open"></i>
            <p class="card-text mb-0">Abandonos</p>
            <p class="lead text-center">{{ totalAbandonos }}</p>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card mb-4">
          <div class="card-body text-center incapacidades">
            <i class="ri-user-unfollow-line"></i>
            <p class="card-text mb-0">Suspensiones</p>
            <p class="lead text-center">{{ totalSuspensiones }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
