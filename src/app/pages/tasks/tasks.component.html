<div class="row d-flex justify-content-between">
  <div class="col-md-11">
    <ul
      ngbNav
      #nav="ngbNav"
      [(activeId)]="active"
      class="nav nav-tabs justify-content-center"
      role="tablist"
    >
      <li [ngbNavItem]="1" class="nav-item flex-sm-fill">
        <a
          ngbNavLink
          data-toggle="tab"
          role="tab"
          aria-controls="home"
          aria-selected="true"
          (click)="getTasks()"
          class="nav-link border-0 text-uppercase font-weight-bold"
          >Tareas</a
        >
        <ng-template ngbNavContent>
          <div class="mt-4">
            <div class="row" cdkDropListGroup>
              <div class="col-md-3">
                <div class="card">
                  <div class="card-header text-center">
                    <h4 class="card-title">Pendientes</h4>
                    <hr style="border-color: #ef476f" />
                  </div>
                  <div
                    #list
                    class="m-2 example-list"
                    cdkDropList
                    [cdkDropListData]="pendientes"
                    cdkDropListSortingDisabled
                    [cdkDropListConnectedTo]="[
                      'list-ejecucion',
                      'list-espera',
                      'list-finalizado'
                    ]"
                    (cdkDropListDropped)="drop($event)"
                    id="list-pendientes"
                  >
                    <ng-container
                      *ngIf="
                        !loadingPendientes && pendientes.length > 0;
                        else notDataPendientes
                      "
                    >
                      <div
                        class="card bg-light"
                        *ngFor="let item of pendientes"
                        cdkDrag
                        [routerLink]="['/task', item.id]"
                      >
                        <app-card-task [list]="item"></app-card-task>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="card">
                  <div class="card-header text-center">
                    <h5 class="card-title">En ejecución</h5>
                    <hr style="border-color: #ffd166" />
                  </div>
                  <div
                    class="m-2 example-list"
                    cdkDropList
                    [cdkDropListData]="ejecucion"
                    [cdkDropListConnectedTo]="[
                      'list-pendientes',
                      'list-espera',
                      'list-finalizado'
                    ]"
                    (cdkDropListDropped)="drop($event)"
                    id="list-ejecucion"
                  >
                    <ng-container
                      *ngIf="
                        !loadingEjecucion && ejecucion.length > 0;
                        else notDataEjecucion
                      "
                    >
                      <div
                        class="card bg-light"
                        *ngFor="let item of ejecucion"
                        cdkDrag
                        [routerLink]="['/task', item.id]"
                      >
                        <app-card-task [list]="item"></app-card-task>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="card">
                  <div class="card-header text-center">
                    <h5 class="card-title">En espera</h5>
                    <hr style="border-color: #118ab2" />
                  </div>
                  <div
                    class="m-2 example-list"
                    cdkDropList
                    [cdkDropListData]="espera"
                    [cdkDropListConnectedTo]="[
                      'list-ejecucion',
                      'list-pendientes',
                      'list-finalizado'
                    ]"
                    (cdkDropListDropped)="drop($event)"
                    id="list-espera"
                  >
                    <ng-container
                      *ngIf="
                        !loadingEspera && espera.length > 0;
                        else notDataEspera
                      "
                    >
                      <div
                        class="card bg-light"
                        *ngFor="let item of espera"
                        cdkDrag
                        [routerLink]="['/task', item.id]"
                      >
                        <app-card-task [list]="item"></app-card-task>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="card">
                  <div class="card-header">
                    <h5 class="card-title text-center">Finalizado</h5>
                    <hr style="border-color: #06d6a0" />
                  </div>
                  <div
                    class="m-2 example-list"
                    cdkDropList
                    [cdkDropListData]="finalizado"
                    [cdkDropListConnectedTo]="[
                      'list-ejecucion',
                      'list-espera',
                      'list-pendientes'
                    ]"
                    (cdkDropListDropped)="drop($event)"
                    id="list-finalizado"
                  >
                    <ng-container
                      *ngIf="
                        !loadingFinalizado && finalizado.length > 0;
                        else notDataFinalizado
                      "
                    >
                      <div
                        class="card bg-light"
                        *ngFor="let item of finalizado"
                        cdkDrag
                        [routerLink]="['/task', item.id]"
                      >
                        <app-card-task [list]="item"></app-card-task>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="2" class="nav-item flex-sm-fill">
        <a
          ngbNavLink
          data-toggle="tab"
          role="tab"
          aria-controls="home"
          aria-selected="true"
          (click)="getTasks()"
          class="nav-link border-0 text-uppercase font-weight-bold"
          >Calendario</a
        >
        <ng-template ngbNavContent>
          <div class="mt-4">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col-3 d-flex justify-content-center">
                    <div class="row">
                      <h6 style="color: #ef476f">●</h6>
                      <p>Pendientes</p>
                    </div>
                  </div>
                  <div class="col-3 d-flex justify-content-center">
                    <div class="row">
                      <h6 style="color: #ffd166">●</h6>
                      <p>En ejecución</p>
                    </div>
                  </div>
                  <div class="col-3 d-flex justify-content-center">
                    <div class="row">
                      <h6 style="color: #118ab2">●</h6>
                      <p>En espera</p>
                    </div>
                  </div>
                  <div class="col-3 d-flex justify-content-center">
                    <div class="row">
                      <h6 style="color: #06d6a0">●</h6>
                      <p>Finalizado</p>
                    </div>
                  </div>
                </div>
                <div class="app-calendar">
                  <full-calendar
                    #calendar
                    defaultView="dayGridMonth"
                    [header]="{
                      left: 'prevYear,prev,next,nextYear today',
                      center: 'title',
                      right: 'dayGridMonth,dayGridWeek,dayGridDay'
                    }"
                    [plugins]="calendarPlugins"
                    [events]="events"
                    (eventClick)="onEventClick($event)"
                    [eventResizableFromStart]="'true'"
                    [eventLimit]="false"
                    themeSystem="bootstrap"
                    [bootstrapFontAwesome]="true"
                    deepChangeDetection="true"
                    locale="es"
                    [eventTimeFormat]="{
                      hour: '2-digit',
                      minute: '2-digit',
                      meridiem: false,
                      hour12: true
                    }"
                  >
                  </full-calendar>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="3" class="nav-item flex-sm-fill">
        <a
          ngbNavLink
          data-toggle="tab"
          role="tab"
          aria-controls="home"
          aria-selected="true"
          (click)="getAsignadas()"
          class="nav-link border-0 text-uppercase font-weight-bold"
          >Asignadas por mí</a
        >
        <ng-template ngbNavContent>
          <div class="mt-4">
            <div class="card">
              <div class="card-body">
                <ng-container
                  *ngIf="
                    !loadingAsignadas && asignadas.length > 0;
                    else notDataAsignadas
                  "
                  ><div class="row">
                    <div
                      class="col-md-3"
                      *ngFor="let item of asignadas"
                      [routerLink]="['/task', item.id]"
                    >
                      <div class="card bg-light" role="button">
                        <app-card-task
                          [list]="item"
                          [view_state]="true"
                        ></app-card-task>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="4" class="nav-item flex-sm-fill">
        <a
          ngbNavLink
          data-toggle="tab"
          role="tab"
          aria-controls="home"
          aria-selected="true"
          (click)="getArchivadas()"
          class="nav-link border-0 text-uppercase font-weight-bold"
          >Archivadas</a
        >
        <ng-template ngbNavContent>
          <div class="mt-4">
            <div class="card">
              <div class="card-body">
                <ng-container
                  *ngIf="
                    !loadingArchivadas && archivadas.length > 0;
                    else notDataArchivadas
                  "
                >
                  <div class="row">
                    <div
                      class="col-3"
                      *ngFor="let item of archivadas"
                      [routerLink]="['/task', item.id]"
                    >
                      <div class="card bg-light" role="button">
                        <app-card-task [list]="item"></app-card-task>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </ng-template>
      </li>
    </ul>
  </div>
  <div class="col">
    <button type="button" class="btn btn-primary btn-sm" (click)="openModal()">
      <i class="fa fa-plus"></i> Agregar
    </button>
  </div>
</div>

<div [ngbNavOutlet]="nav" class="mt-2"></div>

<app-new-task
  [open]="open.asObservable()"
  (refresh)="getTasks()"
></app-new-task>

<ng-template #notDataPendientes>
  <app-not-data [loading]="loadingPendientes"></app-not-data>
</ng-template>
<ng-template #notDataEjecucion>
  <app-not-data [loading]="loadingEjecucion"></app-not-data>
</ng-template>
<ng-template #notDataEspera>
  <app-not-data [loading]="loadingEspera"></app-not-data>
</ng-template>
<ng-template #notDataFinalizado>
  <app-not-data [loading]="loadingFinalizado"></app-not-data>
</ng-template>
<ng-template #notDataAsignadas>
  <app-not-data [loading]="loadingAsignadas"></app-not-data>
</ng-template>
<ng-template #notDataArchivadas>
  <app-not-data [loading]="loadingArchivadas"></app-not-data>
</ng-template>
